(this["webpackJsonpraster-react-canvas2"]=this["webpackJsonpraster-react-canvas2"]||[]).push([[12],{101:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(72),a=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var r=this,a=-1,o=0,i=1,s=2,c=3,l=4;this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:n.MOUSE.ROTATE,MIDDLE:n.MOUSE.ZOOM,RIGHT:n.MOUSE.PAN},this.target=new n.Vector3;var u=new n.Vector3,h=1,f=a,d=a,v=new n.Vector3,p=new n.Vector2,m=new n.Vector2,y=new n.Vector3,g=0,b=new n.Vector2,x=new n.Vector2,w=0,S=0,U=new n.Vector2,_=new n.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var M={type:"change"},A={type:"start"},E={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var T=function(){var e=new n.Vector2;return function(t,n){return e.set((t-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),e}}(),C=function(){var e=new n.Vector2;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function D(e){!1!==r.enabled&&(window.removeEventListener("keydown",D),d===a&&(e.keyCode!==r.keys[o]||r.noRotate?e.keyCode!==r.keys[i]||r.noZoom?e.keyCode!==r.keys[s]||r.noPan||(d=s):d=i:d=o))}function k(){!1!==r.enabled&&(d=a,window.addEventListener("keydown",D,!1))}function O(e){if(!1!==r.enabled){if(e.preventDefault(),e.stopPropagation(),f===a)switch(e.button){case r.mouseButtons.LEFT:f=o;break;case r.mouseButtons.MIDDLE:f=i;break;case r.mouseButtons.RIGHT:f=s;break;default:f=a}var t=d!==a?d:f;t!==o||r.noRotate?t!==i||r.noZoom?t!==s||r.noPan||(U.copy(T(e.pageX,e.pageY)),_.copy(U)):(b.copy(T(e.pageX,e.pageY)),x.copy(b)):(m.copy(C(e.pageX,e.pageY)),p.copy(m)),document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",L,!1),r.dispatchEvent(A)}}function P(e){if(!1!==r.enabled){e.preventDefault(),e.stopPropagation();var t=d!==a?d:f;t!==o||r.noRotate?t!==i||r.noZoom?t!==s||r.noPan||_.copy(T(e.pageX,e.pageY)):x.copy(T(e.pageX,e.pageY)):(p.copy(m),m.copy(C(e.pageX,e.pageY)))}}function L(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),f=a,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",L),r.dispatchEvent(E))}function F(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:b.y-=.025*e.deltaY;break;case 1:b.y-=.01*e.deltaY;break;default:b.y-=25e-5*e.deltaY}r.dispatchEvent(A),r.dispatchEvent(E)}}function I(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:f=c,m.copy(C(e.touches[0].pageX,e.touches[0].pageY)),p.copy(m);break;default:f=l;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;S=w=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;U.copy(T(a,o)),_.copy(U)}r.dispatchEvent(A)}}function B(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:p.copy(m),m.copy(C(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;S=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;_.copy(T(a,o))}}function R(e){if(!1!==r.enabled){switch(e.touches.length){case 0:f=a;break;case 1:f=c,m.copy(C(e.touches[0].pageX,e.touches[0].pageY)),p.copy(m)}r.dispatchEvent(E)}}function z(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=function(){var e,t=new n.Vector3,a=new n.Quaternion,o=new n.Vector3,i=new n.Vector3,s=new n.Vector3,c=new n.Vector3;return function(){c.set(m.x-p.x,m.y-p.y,0),(e=c.length())?(v.copy(r.object.position).sub(r.target),o.copy(v).normalize(),i.copy(r.object.up).normalize(),s.crossVectors(i,o).normalize(),i.setLength(m.y-p.y),s.setLength(m.x-p.x),c.copy(i.add(s)),t.crossVectors(c,v).normalize(),e*=r.rotateSpeed,a.setFromAxisAngle(t,e),v.applyQuaternion(a),r.object.up.applyQuaternion(a),y.copy(t),g=e):!r.staticMoving&&g&&(g*=Math.sqrt(1-r.dynamicDampingFactor),v.copy(r.object.position).sub(r.target),a.setFromAxisAngle(y,g),v.applyQuaternion(a),r.object.up.applyQuaternion(a)),p.copy(m)}}(),this.zoomCamera=function(){var e;f===l?(e=w/S,w=S,r.object.isPerspectiveCamera?v.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom*=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(x.y-b.y)*r.zoomSpeed)&&e>0&&(r.object.isPerspectiveCamera?v.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom/=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),r.staticMoving?b.copy(x):b.y+=(x.y-b.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=new n.Vector2,t=new n.Vector3,a=new n.Vector3;return function(){if(e.copy(_).sub(U),e.lengthSq()){if(r.object.isOrthographicCamera){var n=(r.object.right-r.object.left)/r.object.zoom/r.domElement.clientWidth,o=(r.object.top-r.object.bottom)/r.object.zoom/r.domElement.clientWidth;e.x*=n,e.y*=o}e.multiplyScalar(v.length()*r.panSpeed),a.copy(v).cross(r.object.up).setLength(e.x),a.add(t.copy(r.object.up).setLength(e.y)),r.object.position.add(a),r.target.add(a),r.staticMoving?U.copy(_):U.add(e.subVectors(_,U).multiplyScalar(r.dynamicDampingFactor))}}}(),this.checkDistances=function(){r.noZoom&&r.noPan||(v.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,v.setLength(r.maxDistance)),b.copy(x)),v.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,v.setLength(r.minDistance)),b.copy(x)))},this.update=function(){v.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,v),r.object.isPerspectiveCamera?(r.checkDistances(),r.object.lookAt(r.target),u.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(M),u.copy(r.object.position))):r.object.isOrthographicCamera?(r.object.lookAt(r.target),(u.distanceToSquared(r.object.position)>1e-6||h!==r.object.zoom)&&(r.dispatchEvent(M),u.copy(r.object.position),h=r.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){f=a,d=a,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),v.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(M),u.copy(r.object.position),h=r.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",z,!1),this.domElement.removeEventListener("mousedown",O,!1),this.domElement.removeEventListener("wheel",F,!1),this.domElement.removeEventListener("touchstart",I,!1),this.domElement.removeEventListener("touchend",R,!1),this.domElement.removeEventListener("touchmove",B,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",L,!1),window.removeEventListener("keydown",D,!1),window.removeEventListener("keyup",k,!1)},this.domElement.addEventListener("contextmenu",z,!1),this.domElement.addEventListener("mousedown",O,!1),this.domElement.addEventListener("wheel",F,!1),this.domElement.addEventListener("touchstart",I,!1),this.domElement.addEventListener("touchend",R,!1),this.domElement.addEventListener("touchmove",B,!1),window.addEventListener("keydown",D,!1),window.addEventListener("keyup",k,!1),this.handleResize(),this.update()};a.prototype=Object.create(n.EventDispatcher.prototype),a.prototype.constructor=a},105:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(23);function a(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(n.a)(e)););return e}},106:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(105);function a(e,t,r){return(a="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var a=Object(n.a)(e,t);if(a){var o=Object.getOwnPropertyDescriptor(a,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}},119:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return o}));var n=r(72),a=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new n.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:n.MOUSE.ROTATE,MIDDLE:n.MOUSE.DOLLY,RIGHT:n.MOUSE.PAN},this.touches={ONE:n.TOUCH.ROTATE,TWO:n.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(a),r.update(),c=s.NONE},this.update=function(){var t=new n.Vector3,o=(new n.Quaternion).setFromUnitVectors(e.up,new n.Vector3(0,1,0)),i=o.clone().inverse(),p=new n.Vector3,m=new n.Quaternion;return function(){var e=r.object.position;return t.copy(e).sub(r.target),t.applyQuaternion(o),u.setFromVector3(t),r.autoRotate&&c===s.NONE&&M(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi),u.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=f,u.radius=Math.max(r.minDistance,Math.min(r.maxDistance,u.radius)),!0===r.enableDamping?r.target.addScaledVector(d,r.dampingFactor):r.target.add(d),t.setFromSpherical(u),t.applyQuaternion(i),e.copy(r.target).add(t),r.object.lookAt(r.target),!0===r.enableDamping?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,d.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),d.set(0,0,0)),f=1,!!(v||p.distanceToSquared(r.object.position)>l||8*(1-m.dot(r.object.quaternion))>l)&&(r.dispatchEvent(a),p.copy(r.object.position),m.copy(r.object.quaternion),v=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",W,!1),r.domElement.removeEventListener("mousedown",j,!1),r.domElement.removeEventListener("wheel",X,!1),r.domElement.removeEventListener("touchstart",Y,!1),r.domElement.removeEventListener("touchend",H,!1),r.domElement.removeEventListener("touchmove",Z,!1),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",V,!1),r.domElement.removeEventListener("keydown",N,!1)};var r=this,a={type:"change"},o={type:"start"},i={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},c=s.NONE,l=1e-6,u=new n.Spherical,h=new n.Spherical,f=1,d=new n.Vector3,v=!1,p=new n.Vector2,m=new n.Vector2,y=new n.Vector2,g=new n.Vector2,b=new n.Vector2,x=new n.Vector2,w=new n.Vector2,S=new n.Vector2,U=new n.Vector2;function _(){return Math.pow(.95,r.zoomSpeed)}function M(e){h.theta-=e}function A(e){h.phi-=e}var E=function(){var e=new n.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),d.add(e)}}(),T=function(){var e=new n.Vector3;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),d.add(e)}}(),C=function(){var e=new n.Vector3;return function(t,n){var a=r.domElement;if(r.object.isPerspectiveCamera){var o=r.object.position;e.copy(o).sub(r.target);var i=e.length();i*=Math.tan(r.object.fov/2*Math.PI/180),E(2*t*i/a.clientHeight,r.object.matrix),T(2*n*i/a.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(E(t*(r.object.right-r.object.left)/r.object.zoom/a.clientWidth,r.object.matrix),T(n*(r.object.top-r.object.bottom)/r.object.zoom/a.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function D(e){r.object.isPerspectiveCamera?f/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function k(e){r.object.isPerspectiveCamera?f*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(e){p.set(e.clientX,e.clientY)}function P(e){g.set(e.clientX,e.clientY)}function L(e){if(1==e.touches.length)p.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);p.set(t,r)}}function F(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,r)}}function I(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);w.set(0,n)}function B(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,n)}y.subVectors(m,p).multiplyScalar(r.rotateSpeed);var a=r.domElement;M(2*Math.PI*y.x/a.clientHeight),A(2*Math.PI*y.y/a.clientHeight),p.copy(m)}function R(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,n)}x.subVectors(b,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(b)}function z(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);S.set(0,a),U.set(0,Math.pow(S.y/w.y,r.zoomSpeed)),D(U.y),w.copy(S)}function j(e){if(!1!==r.enabled){var t;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){w.set(e.clientX,e.clientY)}(e),c=s.DOLLY;break;case n.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;P(e),c=s.PAN}else{if(!1===r.enableRotate)return;O(e),c=s.ROTATE}break;case n.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;O(e),c=s.ROTATE}else{if(!1===r.enablePan)return;P(e),c=s.PAN}break;default:c=s.NONE}c!==s.NONE&&(document.addEventListener("mousemove",G,!1),document.addEventListener("mouseup",V,!1),r.dispatchEvent(o))}}function G(e){if(!1!==r.enabled)switch(e.preventDefault(),c){case s.ROTATE:if(!1===r.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),y.subVectors(m,p).multiplyScalar(r.rotateSpeed);var t=r.domElement;M(2*Math.PI*y.x/t.clientHeight),A(2*Math.PI*y.y/t.clientHeight),p.copy(m),r.update()}(e);break;case s.DOLLY:if(!1===r.enableZoom)return;!function(e){S.set(e.clientX,e.clientY),U.subVectors(S,w),U.y>0?D(_()):U.y<0&&k(_()),w.copy(S),r.update()}(e);break;case s.PAN:if(!1===r.enablePan)return;!function(e){b.set(e.clientX,e.clientY),x.subVectors(b,g).multiplyScalar(r.panSpeed),C(x.x,x.y),g.copy(b),r.update()}(e)}}function V(e){!1!==r.enabled&&(document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",V,!1),r.dispatchEvent(i),c=s.NONE)}function X(e){!1===r.enabled||!1===r.enableZoom||c!==s.NONE&&c!==s.ROTATE||(e.preventDefault(),e.stopPropagation(),r.dispatchEvent(o),function(e){e.deltaY<0?k(_()):e.deltaY>0&&D(_()),r.update()}(e),r.dispatchEvent(i))}function N(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){var t=!1;switch(e.keyCode){case r.keys.UP:C(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:C(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:C(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:C(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function Y(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case n.TOUCH.ROTATE:if(!1===r.enableRotate)return;L(e),c=s.TOUCH_ROTATE;break;case n.TOUCH.PAN:if(!1===r.enablePan)return;F(e),c=s.TOUCH_PAN;break;default:c=s.NONE}break;case 2:switch(r.touches.TWO){case n.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&I(e),r.enablePan&&F(e)}(e),c=s.TOUCH_DOLLY_PAN;break;case n.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&I(e),r.enableRotate&&L(e)}(e),c=s.TOUCH_DOLLY_ROTATE;break;default:c=s.NONE}break;default:c=s.NONE}c!==s.NONE&&r.dispatchEvent(o)}}function Z(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),c){case s.TOUCH_ROTATE:if(!1===r.enableRotate)return;B(e),r.update();break;case s.TOUCH_PAN:if(!1===r.enablePan)return;R(e),r.update();break;case s.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&z(e),r.enablePan&&R(e)}(e),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&z(e),r.enableRotate&&B(e)}(e),r.update();break;default:c=s.NONE}}function H(e){!1!==r.enabled&&(r.dispatchEvent(i),c=s.NONE)}function W(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",W,!1),r.domElement.addEventListener("mousedown",j,!1),r.domElement.addEventListener("wheel",X,!1),r.domElement.addEventListener("touchstart",Y,!1),r.domElement.addEventListener("touchend",H,!1),r.domElement.addEventListener("touchmove",Z,!1),r.domElement.addEventListener("keydown",N,!1),-1===r.domElement.tabIndex&&(r.domElement.tabIndex=0),this.update()};a.prototype=Object.create(n.EventDispatcher.prototype),a.prototype.constructor=a;var o=function(e,t){a.call(this,e,t),this.mouseButtons.LEFT=n.MOUSE.PAN,this.mouseButtons.RIGHT=n.MOUSE.ROTATE,this.touches.ONE=n.TOUCH.PAN,this.touches.TWO=n.TOUCH.DOLLY_ROTATE};o.prototype=Object.create(n.EventDispatcher.prototype),o.prototype.constructor=o},123:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(72),a=r(94),o=r(85),i=function(e,t){n.Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==e?e:new a.a,this.material=void 0!==t?t:new o.a({color:16777215*Math.random()})};i.prototype=Object.assign(Object.create(n.Mesh.prototype),{constructor:i,isLineSegments2:!0,computeLineDistances:function(){var e=new n.Vector3,t=new n.Vector3;return function(){for(var r=this.geometry,a=r.attributes.instanceStart,o=r.attributes.instanceEnd,i=new Float32Array(2*a.data.count),s=0,c=0,l=a.data.count;s<l;s++,c+=2)e.fromBufferAttribute(a,s),t.fromBufferAttribute(o,s),i[c]=0===c?0:i[c-1],i[c+1]=i[c]+e.distanceTo(t);var u=new n.InstancedInterleavedBuffer(i,2,1);return r.setAttribute("instanceDistanceStart",new n.InterleavedBufferAttribute(u,1,0)),r.setAttribute("instanceDistanceEnd",new n.InterleavedBufferAttribute(u,1,1)),this}}(),raycast:function(){var e=new n.Vector4,t=new n.Vector4,r=new n.Vector4,a=new n.Vector3,o=new n.Matrix4,i=new n.Line3,s=new n.Vector3;return function(c,l){null===c.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var u=c.ray,h=c.camera,f=h.projectionMatrix,d=this.geometry,v=this.material,p=v.resolution,m=v.linewidth,y=d.attributes.instanceStart,g=d.attributes.instanceEnd;u.at(1,r),r.w=1,r.applyMatrix4(h.matrixWorldInverse),r.applyMatrix4(f),r.multiplyScalar(1/r.w),r.x*=p.x/2,r.y*=p.y/2,r.z=0,a.copy(r);var b=this.matrixWorld;o.multiplyMatrices(h.matrixWorldInverse,b);for(var x=0,w=y.count;x<w;x++){e.fromBufferAttribute(y,x),t.fromBufferAttribute(g,x),e.w=1,t.w=1,e.applyMatrix4(o),t.applyMatrix4(o),e.applyMatrix4(f),t.applyMatrix4(f),e.multiplyScalar(1/e.w),t.multiplyScalar(1/t.w);var S=e.z<-1&&t.z<-1,U=e.z>1&&t.z>1;if(!S&&!U){e.x*=p.x/2,e.y*=p.y/2,t.x*=p.x/2,t.y*=p.y/2,i.start.copy(e),i.start.z=0,i.end.copy(t),i.end.z=0;var _=i.closestPointToPointParameter(a,!0);i.at(_,s);var M=n.MathUtils.lerp(e.z,t.z,_),A=M>=-1&&M<=1,E=a.distanceTo(s)<.5*m;if(A&&E){i.start.fromBufferAttribute(y,x),i.end.fromBufferAttribute(g,x),i.start.applyMatrix4(b),i.end.applyMatrix4(b);var T=new n.Vector3,C=new n.Vector3;u.distanceSqToSegment(i.start,i.end,C,T),l.push({point:C,pointOnLine:T,distance:u.origin.distanceTo(C),object:this,face:null,faceIndex:x,uv:null,uv2:null})}}}}}()});var s=r(93),c=function(e,t){i.call(this),this.type="Line2",this.geometry=void 0!==e?e:new s.a,this.material=void 0!==t?t:new o.a({color:16777215*Math.random()})};c.prototype=Object.assign(Object.create(i.prototype),{constructor:c,isLine2:!0})},247:function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t,n="object"==typeof self&&self&&self.Object===Object&&self,a=r||n||Function("return this")();function o(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function i(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var s=Object.prototype,c=s.hasOwnProperty,l=s.toString,u=a.Symbol,h=s.propertyIsEnumerable,f=u?u.isConcatSpreadable:void 0,d=Math.max;function v(e){return m(e)||function(e){return function(e){return y(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?l.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)}(e)}(e)&&c.call(e,"callee")&&(!h.call(e,"callee")||"[object Arguments]"==l.call(e))}(e)||!!(f&&e&&e[f])}function p(e){if("string"==typeof e||function(e){return"symbol"==typeof e||y(e)&&"[object Symbol]"==l.call(e)}(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}var m=Array.isArray;function y(e){return!!e&&"object"==typeof e}var g,b,x=(g=function(e,t){return null==e?{}:function(e,t){return function(e,t,r){for(var n=-1,a=t.length,o={};++n<a;){var i=t[n],s=e[i];r(s,i)&&(o[i]=s)}return o}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t){for(var r=-1,n=e?e.length:0,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}(function e(t,r,n,a,o){var s=-1,c=t.length;for(n||(n=v),o||(o=[]);++s<c;){var l=t[s];r>0&&n(l)?r>1?e(l,r-1,n,a,o):i(o,l):a||(o[o.length]=l)}return o}(t,1),p))},b=d(void 0===b?g.length-1:b,0),function(){for(var e=arguments,t=-1,r=d(e.length-b,0),n=Array(r);++t<r;)n[t]=e[b+t];t=-1;for(var a=Array(b+1);++t<b;)a[t]=e[t];return a[b]=n,o(g,this,a)});e.exports=x}).call(this,r(40))},248:function(e,t,r){(function(t){var r=/^\[object .+?Constructor\]$/,n=/^(?:0|[1-9]\d*)$/,a="object"==typeof t&&t&&t.Object===Object&&t,o="object"==typeof self&&self&&self.Object===Object&&self,i=a||o||Function("return this")();function s(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function c(e,t){return!!(e?e.length:0)&&function(e,t,r){if(t!==t)return function(e,t,r,n){var a=e.length,o=r+(n?1:-1);for(;n?o--:++o<a;)if(t(e[o],o,e))return o;return-1}(e,f,r);var n=r-1,a=e.length;for(;++n<a;)if(e[n]===t)return n;return-1}(e,t,0)>-1}function l(e,t,r){for(var n=-1,a=e?e.length:0;++n<a;)if(r(t,e[n]))return!0;return!1}function u(e,t){for(var r=-1,n=e?e.length:0,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}function h(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}function f(e){return e!==e}function d(e,t){return e.has(t)}function v(e,t){return function(r){return e(t(r))}}var p=Array.prototype,m=Function.prototype,y=Object.prototype,g=i["__core-js_shared__"],b=function(){var e=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),x=m.toString,w=y.hasOwnProperty,S=y.toString,U=RegExp("^"+x.call(w).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_=i.Symbol,M=v(Object.getPrototypeOf,Object),A=y.propertyIsEnumerable,E=p.splice,T=_?_.isConcatSpreadable:void 0,C=Object.getOwnPropertySymbols,D=Math.max,k=X(i,"Map"),O=X(Object,"create");function P(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function L(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function F(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function I(e){var t=-1,r=e?e.length:0;for(this.__data__=new F;++t<r;)this.add(e[t])}function B(e,t){var r=Q(e)||q(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,a=!!n;for(var o in e)!t&&!w.call(e,o)||a&&("length"==o||H(o,n))||r.push(o);return r}function R(e,t){for(var r,n,a=e.length;a--;)if((r=e[a][0])===(n=t)||r!==r&&n!==n)return a;return-1}function z(e){return!(!J(e)||(t=e,b&&b in t))&&($(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}(e)?U:r).test(function(e){if(null!=e){try{return x.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e));var t}function j(e){if(!J(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||y;return e===r}(e),r=[];for(var n in e)("constructor"!=n||!t&&w.call(e,n))&&r.push(n);return r}function G(e){return function(e,t,r){var n=t(e);return Q(e)?n:h(n,r(e))}(e,te,Y)}function V(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function X(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return z(r)?r:void 0}P.prototype.clear=function(){this.__data__=O?O(null):{}},P.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},P.prototype.get=function(e){var t=this.__data__;if(O){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return w.call(t,e)?t[e]:void 0},P.prototype.has=function(e){var t=this.__data__;return O?void 0!==t[e]:w.call(t,e)},P.prototype.set=function(e,t){return this.__data__[e]=O&&void 0===t?"__lodash_hash_undefined__":t,this},L.prototype.clear=function(){this.__data__=[]},L.prototype.delete=function(e){var t=this.__data__,r=R(t,e);return!(r<0)&&(r==t.length-1?t.pop():E.call(t,r,1),!0)},L.prototype.get=function(e){var t=this.__data__,r=R(t,e);return r<0?void 0:t[r][1]},L.prototype.has=function(e){return R(this.__data__,e)>-1},L.prototype.set=function(e,t){var r=this.__data__,n=R(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},F.prototype.clear=function(){this.__data__={hash:new P,map:new(k||L),string:new P}},F.prototype.delete=function(e){return V(this,e).delete(e)},F.prototype.get=function(e){return V(this,e).get(e)},F.prototype.has=function(e){return V(this,e).has(e)},F.prototype.set=function(e,t){return V(this,e).set(e,t),this},I.prototype.add=I.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},I.prototype.has=function(e){return this.__data__.has(e)};var N=C?v(C,Object):oe,Y=C?function(e){for(var t=[];e;)h(t,N(e)),e=M(e);return t}:oe;function Z(e){return Q(e)||q(e)||!!(T&&e&&e[T])}function H(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||n.test(e))&&e>-1&&e%1==0&&e<t}function W(e){if("string"==typeof e||function(e){return"symbol"==typeof e||ee(e)&&"[object Symbol]"==S.call(e)}(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function q(e){return function(e){return ee(e)&&K(e)}(e)&&w.call(e,"callee")&&(!A.call(e,"callee")||"[object Arguments]"==S.call(e))}var Q=Array.isArray;function K(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!$(e)}function $(e){var t=J(e)?S.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function J(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ee(e){return!!e&&"object"==typeof e}function te(e){return K(e)?B(e,!0):j(e)}var re,ne,ae=(re=function(e,t){return null==e?{}:(t=u(function e(t,r,n,a,o){var i=-1,s=t.length;for(n||(n=Z),o||(o=[]);++i<s;){var c=t[i];r>0&&n(c)?r>1?e(c,r-1,n,a,o):h(o,c):a||(o[o.length]=c)}return o}(t,1),W),function(e,t){return function(e,t,r){for(var n=-1,a=t.length,o={};++n<a;){var i=t[n],s=e[i];r(s,i)&&(o[i]=s)}return o}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t,r,n){var a,o=-1,i=c,s=!0,h=e.length,f=[],v=t.length;if(!h)return f;r&&(t=u(t,(a=r,function(e){return a(e)}))),n?(i=l,s=!1):t.length>=200&&(i=d,s=!1,t=new I(t));e:for(;++o<h;){var p=e[o],m=r?r(p):p;if(p=n||0!==p?p:0,s&&m===m){for(var y=v;y--;)if(t[y]===m)continue e;f.push(p)}else i(t,m,n)||f.push(p)}return f}(G(e),t)))},ne=D(void 0===ne?re.length-1:ne,0),function(){for(var e=arguments,t=-1,r=D(e.length-ne,0),n=Array(r);++t<r;)n[t]=e[ne+t];t=-1;for(var a=Array(ne+1);++t<ne;)a[t]=e[t];return a[ne]=n,s(re,this,a)});function oe(){return[]}e.exports=ae}).call(this,r(40))},249:function(e,t,r){!function(e,t,r,n){"use strict";var a,o=r.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){var e=self,t={parse:function(e){var r=t._bin,n=new Uint8Array(e);if("ttcf"==r.readASCII(n,0,4)){var a=4;r.readUshort(n,a),a+=2,r.readUshort(n,a),a+=2;var o=r.readUint(n,a);a+=4;for(var i=[],s=0;s<o;s++){var c=r.readUint(n,a);a+=4,i.push(t._readFont(n,c))}return i}return[t._readFont(n,0)]},_readFont:function(e,r){var n=t._bin,a=r;n.readFixed(e,r),r+=4;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:e,_offset:a},c={},l=0;l<o;l++){var u=n.readASCII(e,r,4);r+=4,n.readUint(e,r),r+=4;var h=n.readUint(e,r);r+=4;var f=n.readUint(e,r);r+=4,c[u]={offset:h,length:f}}for(l=0;l<i.length;l++){var d=i[l];c[d]&&(s[d.trim()]=t[d.trim()].parse(e,c[d].offset,c[d].length,s))}return s},_tabOffset:function(e,r,n){for(var a=t._bin,o=a.readUshort(e,n+4),i=n+12,s=0;s<o;s++){var c=a.readASCII(e,i,4);i+=4,a.readUint(e,i),i+=4;var l=a.readUint(e,i);if(i+=4,a.readUint(e,i),i+=4,c==r)return l}return 0}};return t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){var n=t._bin.t.uint8;return n[0]=e[r+3],n[1]=e[r+2],n[2]=e[r+1],n[3]=e[r],t._bin.t.int32[0]},readInt8:function(e,r){return t._bin.t.uint8[0]=e[r],t._bin.t.int8[0]},readShort:function(e,r){var n=t._bin.t.uint8;return n[1]=e[r],n[0]=e[r+1],t._bin.t.int16[0]},readUshort:function(e,t){return e[t]<<8|e[t+1]},readUshorts:function(e,r,n){for(var a=[],o=0;o<n;o++)a.push(t._bin.readUshort(e,r+2*o));return a},readUint:function(e,r){var n=t._bin.t.uint8;return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t._bin.t.uint32[0]},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n},readUnicode:function(e,t,r){for(var n="",a=0;a<r;a++){var o=e[t++]<<8|e[t++];n+=String.fromCharCode(o)}return n},_tdec:e.TextDecoder?new e.TextDecoder:null,readUTF8:function(e,r,n){var a=t._bin._tdec;return a&&0==r&&n==e.length?a.decode(e):t._bin.readASCII(e,r,n)},readBytes:function(e,t,r){for(var n=[],a=0;a<r;a++)n.push(e[t+a]);return n},readASCIIArray:function(e,t,r){for(var n=[],a=0;a<r;a++)n.push(String.fromCharCode(e[t+a]));return n}},t._bin.t={buff:new ArrayBuffer(8)},t._bin.t.int8=new Int8Array(t._bin.t.buff),t._bin.t.uint8=new Uint8Array(t._bin.t.buff),t._bin.t.int16=new Int16Array(t._bin.t.buff),t._bin.t.uint16=new Uint16Array(t._bin.t.buff),t._bin.t.int32=new Int32Array(t._bin.t.buff),t._bin.t.uint32=new Uint32Array(t._bin.t.buff),t._lctf={},t._lctf.parse=function(e,r,n,a,o){var i=t._bin,s={},c=r;i.readFixed(e,r),r+=4;var l=i.readUshort(e,r);r+=2;var u=i.readUshort(e,r);r+=2;var h=i.readUshort(e,r);return r+=2,s.scriptList=t._lctf.readScriptList(e,c+l),s.featureList=t._lctf.readFeatureList(e,c+u),s.lookupList=t._lctf.readLookupList(e,c+h,o),s},t._lctf.readLookupList=function(e,r,n){var a=t._bin,o=r,i=[],s=a.readUshort(e,r);r+=2;for(var c=0;c<s;c++){var l=a.readUshort(e,r);r+=2;var u=t._lctf.readLookupTable(e,o+l,n);i.push(u)}return i},t._lctf.readLookupTable=function(e,r,n){var a=t._bin,o=r,i={tabs:[]};i.ltype=a.readUshort(e,r),r+=2,i.flag=a.readUshort(e,r),r+=2;var s=a.readUshort(e,r);r+=2;for(var c=0;c<s;c++){var l=a.readUshort(e,r);r+=2;var u=n(e,i.ltype,o+l);i.tabs.push(u)}return i},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)0!=(e>>>r&1)&&t++;return t},t._lctf.readClassDef=function(e,r){var n=t._bin,a=[],o=n.readUshort(e,r);if(r+=2,1==o){var i=n.readUshort(e,r);r+=2;var s=n.readUshort(e,r);r+=2;for(var c=0;c<s;c++)a.push(i+c),a.push(i+c),a.push(n.readUshort(e,r)),r+=2}if(2==o){var l=n.readUshort(e,r);for(r+=2,c=0;c<l;c++)a.push(n.readUshort(e,r)),r+=2,a.push(n.readUshort(e,r)),r+=2,a.push(n.readUshort(e,r)),r+=2}return a},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var n=e[r],a=e[r+1];if(e[r+2],n<=t&&t<=a)return r}return-1},t._lctf.readCoverage=function(e,r){var n=t._bin,a={};a.fmt=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);return r+=2,1==a.fmt&&(a.tab=n.readUshorts(e,r,o)),2==a.fmt&&(a.tab=n.readUshorts(e,r,3*o)),a},t._lctf.coverageIndex=function(e,r){var n=e.tab;if(1==e.fmt)return n.indexOf(r);if(2==e.fmt){var a=t._lctf.getInterval(n,r);if(-1!=a)return n[a+2]+(r-n[a])}return-1},t._lctf.readFeatureList=function(e,r){var n=t._bin,a=r,o=[],i=n.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var c=n.readASCII(e,r,4);r+=4;var l=n.readUshort(e,r);r+=2,o.push({tag:c.trim(),tab:t._lctf.readFeatureTable(e,a+l)})}return o},t._lctf.readFeatureTable=function(e,r){var n=t._bin;n.readUshort(e,r),r+=2;var a=n.readUshort(e,r);r+=2;for(var o=[],i=0;i<a;i++)o.push(n.readUshort(e,r+2*i));return o},t._lctf.readScriptList=function(e,r){var n=t._bin,a=r,o={},i=n.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var c=n.readASCII(e,r,4);r+=4;var l=n.readUshort(e,r);r+=2,o[c.trim()]=t._lctf.readScriptTable(e,a+l)}return o},t._lctf.readScriptTable=function(e,r){var n=t._bin,a=r,o={},i=n.readUshort(e,r);r+=2,o.default=t._lctf.readLangSysTable(e,a+i);var s=n.readUshort(e,r);r+=2;for(var c=0;c<s;c++){var l=n.readASCII(e,r,4);r+=4;var u=n.readUshort(e,r);r+=2,o[l.trim()]=t._lctf.readLangSysTable(e,a+u)}return o},t._lctf.readLangSysTable=function(e,r){var n=t._bin,a={};n.readUshort(e,r),r+=2,a.reqFeature=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);return r+=2,a.features=n.readUshorts(e,r,o),a},t.CFF={},t.CFF.parse=function(e,r,n){var a=t._bin;(e=new Uint8Array(e.buffer,r,n))[r=0],e[++r],e[++r],e[++r],r++;var o=[];r=t.CFF.readIndex(e,r,o);for(var i=[],s=0;s<o.length-1;s++)i.push(a.readASCII(e,r+o[s],o[s+1]-o[s]));r+=o[o.length-1];var c=[];r=t.CFF.readIndex(e,r,c);var l=[];for(s=0;s<c.length-1;s++)l.push(t.CFF.readDict(e,r+c[s],r+c[s+1]));r+=c[c.length-1];var u=l[0],h=[];r=t.CFF.readIndex(e,r,h);var f=[];for(s=0;s<h.length-1;s++)f.push(a.readASCII(e,r+h[s],h[s+1]-h[s]));if(r+=h[h.length-1],t.CFF.readSubrs(e,r,u),u.CharStrings){r=u.CharStrings,h=[],r=t.CFF.readIndex(e,r,h);var d=[];for(s=0;s<h.length-1;s++)d.push(a.readBytes(e,r+h[s],h[s+1]-h[s]));u.CharStrings=d}if(u.ROS){r=u.FDArray;var v=[];for(r=t.CFF.readIndex(e,r,v),u.FDArray=[],s=0;s<v.length-1;s++){var p=t.CFF.readDict(e,r+v[s],r+v[s+1]);t.CFF._readFDict(e,p,f),u.FDArray.push(p)}r+=v[v.length-1],r=u.FDSelect,u.FDSelect=[];var m=e[r];if(r++,3!=m)throw m;var y=a.readUshort(e,r);for(r+=2,s=0;s<y+1;s++)u.FDSelect.push(a.readUshort(e,r),e[r+2]),r+=3}return u.Encoding&&(u.Encoding=t.CFF.readEncoding(e,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=t.CFF.readCharset(e,u.charset,u.CharStrings.length)),t.CFF._readFDict(e,u,f),u},t.CFF._readFDict=function(e,r,n){var a;for(var o in r.Private&&(a=r.Private[1],r.Private=t.CFF.readDict(e,a,a+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,a+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)&&(r[o]=n[r[o]-426+35])},t.CFF.readSubrs=function(e,r,n){var a=t._bin,o=[];r=t.CFF.readIndex(e,r,o);var i,s=o.length;i=s<1240?107:s<33900?1131:32768,n.Bias=i,n.Subrs=[];for(var c=0;c<o.length-1;c++)n.Subrs.push(a.readBytes(e,r+o[c],o[c+1]-o[c]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return-1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,n){t._bin;var a=[".notdef"],o=e[r];if(r++,0!=o)throw"error: unknown encoding format: "+o;var i=e[r];r++;for(var s=0;s<i;s++)a.push(e[r+s]);return a},t.CFF.readCharset=function(e,r,n){var a=t._bin,o=[".notdef"],i=e[r];if(r++,0==i)for(var s=0;s<n;s++){var c=a.readUshort(e,r);r+=2,o.push(c)}else{if(1!=i&&2!=i)throw"error: format: "+i;for(;o.length<n;){c=a.readUshort(e,r),r+=2;var l=0;for(1==i?(l=e[r],r++):(l=a.readUshort(e,r),r+=2),s=0;s<=l;s++)o.push(c),c++}}return o},t.CFF.readIndex=function(e,r,n){var a=t._bin,o=a.readUshort(e,r)+1,i=e[r+=2];if(r++,1==i)for(var s=0;s<o;s++)n.push(e[r+s]);else if(2==i)for(s=0;s<o;s++)n.push(a.readUshort(e,r+2*s));else if(3==i)for(s=0;s<o;s++)n.push(16777215&a.readUint(e,r+3*s-1));else if(1!=o)throw"unsupported offset size: "+i+", count: "+o;return(r+=o*i)-1},t.CFF.getCharString=function(e,r,n){var a=t._bin,o=e[r],i=e[r+1],s=(e[r+2],e[r+3],e[r+4],1),c=null,l=null;o<=20&&(c=o,s=1),12==o&&(c=100*o+i,s=2),21<=o&&o<=27&&(c=o,s=1),28==o&&(l=a.readShort(e,r+1),s=3),29<=o&&o<=31&&(c=o,s=1),32<=o&&o<=246&&(l=o-139,s=1),247<=o&&o<=250&&(l=256*(o-247)+i+108,s=2),251<=o&&o<=254&&(l=256*-(o-251)-i-108,s=2),255==o&&(l=a.readInt(e,r+1)/65535,s=5),n.val=null!=l?l:"o"+c,n.size=s},t.CFF.readCharString=function(e,r,n){for(var a=r+n,o=t._bin,i=[];r<a;){var s=e[r],c=e[r+1],l=(e[r+2],e[r+3],e[r+4],1),u=null,h=null;s<=20&&(u=s,l=1),12==s&&(u=100*s+c,l=2),19!=s&&20!=s||(u=s,l=2),21<=s&&s<=27&&(u=s,l=1),28==s&&(h=o.readShort(e,r+1),l=3),29<=s&&s<=31&&(u=s,l=1),32<=s&&s<=246&&(h=s-139,l=1),247<=s&&s<=250&&(h=256*(s-247)+c+108,l=2),251<=s&&s<=254&&(h=256*-(s-251)-c-108,l=2),255==s&&(h=o.readInt(e,r+1)/65535,l=5),i.push(null!=h?h:"o"+u),r+=l}return i},t.CFF.readDict=function(e,r,n){for(var a=t._bin,o={},i=[];r<n;){var s=e[r],c=e[r+1],l=(e[r+2],e[r+3],e[r+4],1),u=null,h=null;if(28==s&&(h=a.readShort(e,r+1),l=3),29==s&&(h=a.readInt(e,r+1),l=5),32<=s&&s<=246&&(h=s-139,l=1),247<=s&&s<=250&&(h=256*(s-247)+c+108,l=2),251<=s&&s<=254&&(h=256*-(s-251)-c-108,l=2),255==s)throw h=a.readInt(e,r+1)/65535,l=5,"unknown number";if(30==s){var f=[];for(l=1;;){var d=e[r+l];l++;var v=d>>4,p=15&d;if(15!=v&&f.push(v),15!=p&&f.push(p),15==p)break}for(var m="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],g=0;g<f.length;g++)m+=y[f[g]];h=parseFloat(m)}s<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],l=1,12==s&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][c],l=2)),null!=u?(o[u]=1==i.length?i[0]:i,i=[]):i.push(h),r+=l}return o},t.cmap={},t.cmap.parse=function(e,r,n){e=new Uint8Array(e.buffer,r,n),r=0;var a=t._bin,o={};a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);r+=2;var s=[];o.tables=[];for(var c=0;c<i;c++){var l=a.readUshort(e,r);r+=2;var u=a.readUshort(e,r);r+=2;var h=a.readUint(e,r);r+=4;var f="p"+l+"e"+u,d=s.indexOf(h);if(-1==d){var v;d=o.tables.length,s.push(h);var p=a.readUshort(e,h);0==p?v=t.cmap.parse0(e,h):4==p?v=t.cmap.parse4(e,h):6==p?v=t.cmap.parse6(e,h):12==p?v=t.cmap.parse12(e,h):console.log("unknown format: "+p,l,u,h),o.tables.push(v)}if(null!=o[f])throw"multiple tables for one platform+encoding";o[f]=d}return o},t.cmap.parse0=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,a.map=[];for(var i=0;i<o-6;i++)a.map.push(e[r+i]);return a},t.cmap.parse4=function(e,r){var n=t._bin,a=r,o={};o.format=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;var c=s/2;o.searchRange=n.readUshort(e,r),r+=2,o.entrySelector=n.readUshort(e,r),r+=2,o.rangeShift=n.readUshort(e,r),r+=2,o.endCount=n.readUshorts(e,r,c),r+=2*c,r+=2,o.startCount=n.readUshorts(e,r,c),r+=2*c,o.idDelta=[];for(var l=0;l<c;l++)o.idDelta.push(n.readShort(e,r)),r+=2;for(o.idRangeOffset=n.readUshorts(e,r,c),r+=2*c,o.glyphIdArray=[];r<a+i;)o.glyphIdArray.push(n.readUshort(e,r)),r+=2;return o},t.cmap.parse6=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,a.firstCode=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,a.glyphIdArray=[];for(var i=0;i<o;i++)a.glyphIdArray.push(n.readUshort(e,r)),r+=2;return a},t.cmap.parse12=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2,r+=2,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4;var o=n.readUint(e,r);r+=4,a.groups=[];for(var i=0;i<o;i++){var s=r+12*i,c=n.readUint(e,s+0),l=n.readUint(e,s+4),u=n.readUint(e,s+8);a.groups.push([c,l,u])}return a},t.glyf={},t.glyf.parse=function(e,t,r,n){for(var a=[],o=0;o<n.maxp.numGlyphs;o++)a.push(null);return a},t.glyf._parseGlyf=function(e,r){var n=t._bin,a=e._data,o=t._tabOffset(a,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var i={};if(i.noc=n.readShort(a,o),o+=2,i.xMin=n.readShort(a,o),o+=2,i.yMin=n.readShort(a,o),o+=2,i.xMax=n.readShort(a,o),o+=2,i.yMax=n.readShort(a,o),o+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(n.readUshort(a,o)),o+=2;var c=n.readUshort(a,o);if(o+=2,a.length-o<c)return null;i.instructions=n.readBytes(a,o,c),o+=c;var l=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<l;s++){var u=a[o];if(o++,i.flags.push(u),0!=(8&u)){var h=a[o];o++;for(var f=0;f<h;f++)i.flags.push(u),s++}}for(i.xs=[],s=0;s<l;s++){var d=0!=(2&i.flags[s]),v=0!=(16&i.flags[s]);d?(i.xs.push(v?a[o]:-a[o]),o++):v?i.xs.push(0):(i.xs.push(n.readShort(a,o)),o+=2)}for(i.ys=[],s=0;s<l;s++)d=0!=(4&i.flags[s]),v=0!=(32&i.flags[s]),d?(i.ys.push(v?a[o]:-a[o]),o++):v?i.ys.push(0):(i.ys.push(n.readShort(a,o)),o+=2);var p=0,m=0;for(s=0;s<l;s++)p+=i.xs[s],m+=i.ys[s],i.xs[s]=p,i.ys[s]=m}else{var y;i.parts=[];do{y=n.readUshort(a,o),o+=2;var g={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(g),g.glyphIndex=n.readUshort(a,o),o+=2,1&y){var b=n.readShort(a,o);o+=2;var x=n.readShort(a,o);o+=2}else b=n.readInt8(a,o),o++,x=n.readInt8(a,o),o++;2&y?(g.m.tx=b,g.m.ty=x):(g.p1=b,g.p2=x),8&y?(g.m.a=g.m.d=n.readF2dot14(a,o),o+=2):64&y?(g.m.a=n.readF2dot14(a,o),o+=2,g.m.d=n.readF2dot14(a,o),o+=2):128&y&&(g.m.a=n.readF2dot14(a,o),o+=2,g.m.b=n.readF2dot14(a,o),o+=2,g.m.c=n.readF2dot14(a,o),o+=2,g.m.d=n.readF2dot14(a,o),o+=2)}while(32&y);if(256&y){var w=n.readUshort(a,o);for(o+=2,i.instr=[],s=0;s<w;s++)i.instr.push(a[o]),o++}}return i},t.GPOS={},t.GPOS.parse=function(e,r,n,a){return t._lctf.parse(e,r,n,a,t.GPOS.subt)},t.GPOS.subt=function(e,r,n){var a=t._bin,o=n,i={};if(i.fmt=a.readUshort(e,n),n+=2,1==r||2==r||3==r||7==r||8==r&&i.fmt<=2){var s=a.readUshort(e,n);n+=2,i.coverage=t._lctf.readCoverage(e,s+o)}if(1==r&&1==i.fmt){var c=a.readUshort(e,n);n+=2;var l=t._lctf.numOfOnes(c);0!=c&&(i.pos=t.GPOS.readValueRecord(e,n,c))}else if(2==r){c=a.readUshort(e,n),n+=2;var u=a.readUshort(e,n);n+=2,l=t._lctf.numOfOnes(c);var h=t._lctf.numOfOnes(u);if(1==i.fmt){i.pairsets=[];var f=a.readUshort(e,n);n+=2;for(var d=0;d<f;d++){var v=o+a.readUshort(e,n);n+=2;var p=a.readUshort(e,v);v+=2;for(var m=[],y=0;y<p;y++){var g=a.readUshort(e,v);v+=2,0!=c&&(_=t.GPOS.readValueRecord(e,v,c),v+=2*l),0!=u&&(M=t.GPOS.readValueRecord(e,v,u),v+=2*h),m.push({gid2:g,val1:_,val2:M})}i.pairsets.push(m)}}if(2==i.fmt){var b=a.readUshort(e,n);n+=2;var x=a.readUshort(e,n);n+=2;var w=a.readUshort(e,n);n+=2;var S=a.readUshort(e,n);for(n+=2,i.classDef1=t._lctf.readClassDef(e,o+b),i.classDef2=t._lctf.readClassDef(e,o+x),i.matrix=[],d=0;d<w;d++){var U=[];for(y=0;y<S;y++){var _=null,M=null;0!=i.valFmt1&&(_=t.GPOS.readValueRecord(e,n,i.valFmt1),n+=2*l),0!=i.valFmt2&&(M=t.GPOS.readValueRecord(e,n,i.valFmt2),n+=2*h),U.push({val1:_,val2:M})}i.matrix.push(U)}}}return i},t.GPOS.readValueRecord=function(e,r,n){var a=t._bin,o=[];return o.push(1&n?a.readShort(e,r):0),r+=1&n?2:0,o.push(2&n?a.readShort(e,r):0),r+=2&n?2:0,o.push(4&n?a.readShort(e,r):0),r+=4&n?2:0,o.push(8&n?a.readShort(e,r):0),r+=8&n?2:0,o},t.GSUB={},t.GSUB.parse=function(e,r,n,a){return t._lctf.parse(e,r,n,a,t.GSUB.subt)},t.GSUB.subt=function(e,r,n){var a=t._bin,o=n,i={};if(i.fmt=a.readUshort(e,n),n+=2,1!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||4==r||5==r&&i.fmt<=2||6==r&&i.fmt<=2){var s=a.readUshort(e,n);n+=2,i.coverage=t._lctf.readCoverage(e,o+s)}if(1==r){if(1==i.fmt)i.delta=a.readShort(e,n),n+=2;else if(2==i.fmt){var c=a.readUshort(e,n);n+=2,i.newg=a.readUshorts(e,n,c),n+=2*i.newg.length}}else if(4==r){i.vals=[],c=a.readUshort(e,n),n+=2;for(var l=0;l<c;l++){var u=a.readUshort(e,n);n+=2,i.vals.push(t.GSUB.readLigatureSet(e,o+u))}}else if(5==r){if(2==i.fmt){var h=a.readUshort(e,n);n+=2,i.cDef=t._lctf.readClassDef(e,o+h),i.scset=[];var f=a.readUshort(e,n);for(n+=2,l=0;l<f;l++){var d=a.readUshort(e,n);n+=2,i.scset.push(0==d?null:t.GSUB.readSubClassSet(e,o+d))}}}else if(6==r&&3==i.fmt){for(l=0;l<3;l++){c=a.readUshort(e,n),n+=2;for(var v=[],p=0;p<c;p++)v.push(t._lctf.readCoverage(e,o+a.readUshort(e,n+2*p)));n+=2*c,0==l&&(i.backCvg=v),1==l&&(i.inptCvg=v),2==l&&(i.ahedCvg=v)}c=a.readUshort(e,n),n+=2,i.lookupRec=t.GSUB.readSubstLookupRecords(e,n,c)}return i},t.GSUB.readSubClassSet=function(e,r){var n=t._bin.readUshort,a=r,o=[],i=n(e,r);r+=2;for(var s=0;s<i;s++){var c=n(e,r);r+=2,o.push(t.GSUB.readSubClassRule(e,a+c))}return o},t.GSUB.readSubClassRule=function(e,r){var n=t._bin.readUshort,a={},o=n(e,r),i=n(e,r+=2);r+=2,a.input=[];for(var s=0;s<o-1;s++)a.input.push(n(e,r)),r+=2;return a.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,i),a},t.GSUB.readSubstLookupRecords=function(e,r,n){for(var a=t._bin.readUshort,o=[],i=0;i<n;i++)o.push(a(e,r),a(e,r+2)),r+=4;return o},t.GSUB.readChainSubClassSet=function(e,r){var n=t._bin,a=r,o=[],i=n.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var c=n.readUshort(e,r);r+=2,o.push(t.GSUB.readChainSubClassRule(e,a+c))}return o},t.GSUB.readChainSubClassRule=function(e,r){for(var n=t._bin,a={},o=["backtrack","input","lookahead"],i=0;i<o.length;i++){var s=n.readUshort(e,r);r+=2,1==i&&s--,a[o[i]]=n.readUshorts(e,r,s),r+=2*a[o[i]].length}return s=n.readUshort(e,r),r+=2,a.subst=n.readUshorts(e,r,2*s),r+=2*a.subst.length,a},t.GSUB.readLigatureSet=function(e,r){var n=t._bin,a=r,o=[],i=n.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var c=n.readUshort(e,r);r+=2,o.push(t.GSUB.readLigature(e,a+c))}return o},t.GSUB.readLigature=function(e,r){var n=t._bin,a={chain:[]};a.nglyph=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2;for(var i=0;i<o-1;i++)a.chain.push(n.readUshort(e,r)),r+=2;return a},t.head={},t.head.parse=function(e,r,n){var a=t._bin,o={};return a.readFixed(e,r),r+=4,o.fontRevision=a.readFixed(e,r),r+=4,a.readUint(e,r),r+=4,a.readUint(e,r),r+=4,o.flags=a.readUshort(e,r),r+=2,o.unitsPerEm=a.readUshort(e,r),r+=2,o.created=a.readUint64(e,r),r+=8,o.modified=a.readUint64(e,r),r+=8,o.xMin=a.readShort(e,r),r+=2,o.yMin=a.readShort(e,r),r+=2,o.xMax=a.readShort(e,r),r+=2,o.yMax=a.readShort(e,r),r+=2,o.macStyle=a.readUshort(e,r),r+=2,o.lowestRecPPEM=a.readUshort(e,r),r+=2,o.fontDirectionHint=a.readShort(e,r),r+=2,o.indexToLocFormat=a.readShort(e,r),r+=2,o.glyphDataFormat=a.readShort(e,r),r+=2,o},t.hhea={},t.hhea.parse=function(e,r,n){var a=t._bin,o={};return a.readFixed(e,r),r+=4,o.ascender=a.readShort(e,r),r+=2,o.descender=a.readShort(e,r),r+=2,o.lineGap=a.readShort(e,r),r+=2,o.advanceWidthMax=a.readUshort(e,r),r+=2,o.minLeftSideBearing=a.readShort(e,r),r+=2,o.minRightSideBearing=a.readShort(e,r),r+=2,o.xMaxExtent=a.readShort(e,r),r+=2,o.caretSlopeRise=a.readShort(e,r),r+=2,o.caretSlopeRun=a.readShort(e,r),r+=2,o.caretOffset=a.readShort(e,r),r+=2,r+=8,o.metricDataFormat=a.readShort(e,r),r+=2,o.numberOfHMetrics=a.readUshort(e,r),r+=2,o},t.hmtx={},t.hmtx.parse=function(e,r,n,a){for(var o=t._bin,i={aWidth:[],lsBearing:[]},s=0,c=0,l=0;l<a.maxp.numGlyphs;l++)l<a.hhea.numberOfHMetrics&&(s=o.readUshort(e,r),r+=2,c=o.readShort(e,r),r+=2),i.aWidth.push(s),i.lsBearing.push(c);return i},t.kern={},t.kern.parse=function(e,r,n,a){var o=t._bin,i=o.readUshort(e,r);if(r+=2,1==i)return t.kern.parseV1(e,r-2,n,a);var s=o.readUshort(e,r);r+=2;for(var c={glyph1:[],rval:[]},l=0;l<s;l++){r+=2,n=o.readUshort(e,r),r+=2;var u=o.readUshort(e,r);r+=2;var h=u>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;r=t.kern.readFormat0(e,r,c)}return c},t.kern.parseV1=function(e,r,n,a){var o=t._bin;o.readFixed(e,r),r+=4;var i=o.readUint(e,r);r+=4;for(var s={glyph1:[],rval:[]},c=0;c<i;c++){o.readUint(e,r),r+=4;var l=o.readUshort(e,r);r+=2,o.readUshort(e,r),r+=2;var u=l>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;r=t.kern.readFormat0(e,r,s)}return s},t.kern.readFormat0=function(e,r,n){var a=t._bin,o=-1,i=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2;for(var s=0;s<i;s++){var c=a.readUshort(e,r);r+=2;var l=a.readUshort(e,r);r+=2;var u=a.readShort(e,r);r+=2,c!=o&&(n.glyph1.push(c),n.rval.push({glyph2:[],vals:[]}));var h=n.rval[n.rval.length-1];h.glyph2.push(l),h.vals.push(u),o=c}return r},t.loca={},t.loca.parse=function(e,r,n,a){var o=t._bin,i=[],s=a.head.indexToLocFormat,c=a.maxp.numGlyphs+1;if(0==s)for(var l=0;l<c;l++)i.push(o.readUshort(e,r+(l<<1))<<1);if(1==s)for(l=0;l<c;l++)i.push(o.readUint(e,r+(l<<2)));return i},t.maxp={},t.maxp.parse=function(e,r,n){var a=t._bin,o={},i=a.readUint(e,r);return r+=4,o.numGlyphs=a.readUshort(e,r),r+=2,65536==i&&(o.maxPoints=a.readUshort(e,r),r+=2,o.maxContours=a.readUshort(e,r),r+=2,o.maxCompositePoints=a.readUshort(e,r),r+=2,o.maxCompositeContours=a.readUshort(e,r),r+=2,o.maxZones=a.readUshort(e,r),r+=2,o.maxTwilightPoints=a.readUshort(e,r),r+=2,o.maxStorage=a.readUshort(e,r),r+=2,o.maxFunctionDefs=a.readUshort(e,r),r+=2,o.maxInstructionDefs=a.readUshort(e,r),r+=2,o.maxStackElements=a.readUshort(e,r),r+=2,o.maxSizeOfInstructions=a.readUshort(e,r),r+=2,o.maxComponentElements=a.readUshort(e,r),r+=2,o.maxComponentDepth=a.readUshort(e,r),r+=2),o},t.name={},t.name.parse=function(e,r,n){var a=t._bin,o={};a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);r+=2,a.readUshort(e,r);for(var s,c=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],l=r+=2,u=0;u<i;u++){var h=a.readUshort(e,r);r+=2;var f=a.readUshort(e,r);r+=2;var d=a.readUshort(e,r);r+=2;var v=a.readUshort(e,r);r+=2;var p=a.readUshort(e,r);r+=2;var m=a.readUshort(e,r);r+=2;var y,g=c[v],b=l+12*i+m;if(0==h)y=a.readUnicode(e,b,p/2);else if(3==h&&0==f)y=a.readUnicode(e,b,p/2);else if(0==f)y=a.readASCII(e,b,p);else if(1==f)y=a.readUnicode(e,b,p/2);else if(3==f)y=a.readUnicode(e,b,p/2);else{if(1!=h)throw"unknown encoding "+f+", platformID: "+h;y=a.readASCII(e,b,p),console.log("reading unknown MAC encoding "+f+" as ASCII")}var x="p"+h+","+d.toString(16);null==o[x]&&(o[x]={}),o[x][g]=y,o[x]._lang=d}for(var w in o)if(null!=o[w].postScriptName&&1033==o[w]._lang)return o[w];for(var w in o)if(null!=o[w].postScriptName&&0==o[w]._lang)return o[w];for(var w in o)if(null!=o[w].postScriptName&&3084==o[w]._lang)return o[w];for(var w in o)if(null!=o[w].postScriptName)return o[w];for(var w in o){s=w;break}return console.log("returning name table with languageID "+o[s]._lang),o[s]},t["OS/2"]={},t["OS/2"].parse=function(e,r,n){var a=t._bin.readUshort(e,r);r+=2;var o={};if(0==a)t["OS/2"].version0(e,r,o);else if(1==a)t["OS/2"].version1(e,r,o);else if(2==a||3==a||4==a)t["OS/2"].version2(e,r,o);else{if(5!=a)throw"unknown OS/2 table version: "+a;t["OS/2"].version5(e,r,o)}return o},t["OS/2"].version0=function(e,r,n){var a=t._bin;return n.xAvgCharWidth=a.readShort(e,r),r+=2,n.usWeightClass=a.readUshort(e,r),r+=2,n.usWidthClass=a.readUshort(e,r),r+=2,n.fsType=a.readUshort(e,r),r+=2,n.ySubscriptXSize=a.readShort(e,r),r+=2,n.ySubscriptYSize=a.readShort(e,r),r+=2,n.ySubscriptXOffset=a.readShort(e,r),r+=2,n.ySubscriptYOffset=a.readShort(e,r),r+=2,n.ySuperscriptXSize=a.readShort(e,r),r+=2,n.ySuperscriptYSize=a.readShort(e,r),r+=2,n.ySuperscriptXOffset=a.readShort(e,r),r+=2,n.ySuperscriptYOffset=a.readShort(e,r),r+=2,n.yStrikeoutSize=a.readShort(e,r),r+=2,n.yStrikeoutPosition=a.readShort(e,r),r+=2,n.sFamilyClass=a.readShort(e,r),r+=2,n.panose=a.readBytes(e,r,10),r+=10,n.ulUnicodeRange1=a.readUint(e,r),r+=4,n.ulUnicodeRange2=a.readUint(e,r),r+=4,n.ulUnicodeRange3=a.readUint(e,r),r+=4,n.ulUnicodeRange4=a.readUint(e,r),r+=4,n.achVendID=[a.readInt8(e,r),a.readInt8(e,r+1),a.readInt8(e,r+2),a.readInt8(e,r+3)],r+=4,n.fsSelection=a.readUshort(e,r),r+=2,n.usFirstCharIndex=a.readUshort(e,r),r+=2,n.usLastCharIndex=a.readUshort(e,r),r+=2,n.sTypoAscender=a.readShort(e,r),r+=2,n.sTypoDescender=a.readShort(e,r),r+=2,n.sTypoLineGap=a.readShort(e,r),r+=2,n.usWinAscent=a.readUshort(e,r),r+=2,n.usWinDescent=a.readUshort(e,r),r+=2},t["OS/2"].version1=function(e,r,n){var a=t._bin;return r=t["OS/2"].version0(e,r,n),n.ulCodePageRange1=a.readUint(e,r),r+=4,n.ulCodePageRange2=a.readUint(e,r),r+=4},t["OS/2"].version2=function(e,r,n){var a=t._bin;return r=t["OS/2"].version1(e,r,n),n.sxHeight=a.readShort(e,r),r+=2,n.sCapHeight=a.readShort(e,r),r+=2,n.usDefault=a.readUshort(e,r),r+=2,n.usBreak=a.readUshort(e,r),r+=2,n.usMaxContext=a.readUshort(e,r),r+=2},t["OS/2"].version5=function(e,r,n){var a=t._bin;return r=t["OS/2"].version2(e,r,n),n.usLowerOpticalPointSize=a.readUshort(e,r),r+=2,n.usUpperOpticalPointSize=a.readUshort(e,r),r+=2},t.post={},t.post.parse=function(e,r,n){var a=t._bin,o={};return o.version=a.readFixed(e,r),r+=4,o.italicAngle=a.readFixed(e,r),r+=4,o.underlinePosition=a.readShort(e,r),r+=2,o.underlineThickness=a.readShort(e,r),r+=2,o},t.SVG={},t.SVG.parse=function(e,r,n){var a=t._bin,o={entries:[]},i=r;a.readUshort(e,r),r+=2;var s=a.readUint(e,r);r+=4,a.readUint(e,r),r+=4,r=s+i;var c=a.readUshort(e,r);r+=2;for(var l=0;l<c;l++){var u=a.readUshort(e,r);r+=2;var h=a.readUshort(e,r);r+=2;var f=a.readUint(e,r);r+=4;var d=a.readUint(e,r);r+=4;for(var v=new Uint8Array(e.buffer,i+f+s,d),p=a.readUTF8(v,0,v.length),m=u;m<=h;m++)o.entries[m]=p}return o},t.SVG.toPath=function(e){var r={cmds:[],crds:[]};if(null==e)return r;for(var n=(new DOMParser).parseFromString(e,"image/svg+xml").firstChild;"svg"!=n.tagName;)n=n.nextSibling;var a=n.getAttribute("viewBox");a=a?a.trim().split(" ").map(parseFloat):[0,0,1e3,1e3],t.SVG._toPath(n.children,r);for(var o=0;o<r.crds.length;o+=2){var i=r.crds[o],s=r.crds[o+1];i-=a[0],s=-(s-=a[1]),r.crds[o]=i,r.crds[o+1]=s}return r},t.SVG._toPath=function(e,r,n){for(var a=0;a<e.length;a++){var o=e[a],i=o.tagName,s=o.getAttribute("fill");if(null==s&&(s=n),"g"==i)t.SVG._toPath(o.children,r,s);else if("path"==i){r.cmds.push(s||"#000000");var c=o.getAttribute("d"),l=t.SVG._tokens(c);t.SVG._toksToPath(l,r),r.cmds.push("X")}else"defs"==i||console.log(i,o)}},t.SVG._tokens=function(e){for(var t=[],r=0,n=!1,a="";r<e.length;){var o=e.charCodeAt(r),i=e.charAt(r);r++;var s=48<=o&&o<=57||"."==i||"-"==i;n?"-"==i?(t.push(parseFloat(a)),a=i):s?a+=i:(t.push(parseFloat(a)),","!=i&&" "!=i&&t.push(i),n=!1):s?(a=i,n=!0):","!=i&&" "!=i&&t.push(i)}return n&&t.push(parseFloat(a)),t},t.SVG._toksToPath=function(e,r){for(var n=0,a=0,o=0,i=0,s=0,c={M:2,L:2,H:1,V:1,S:4,C:6},l=r.cmds,u=r.crds;n<e.length;){var h=e[n];if(n++,"z"==h)l.push("Z"),a=i,o=s;else for(var f=h.toUpperCase(),d=c[f],v=t.SVG._reps(e,n,d),p=0;p<v;p++){var m=0,y=0;if(h!=f&&(m=a,y=o),"M"==f)a=m+e[n++],o=y+e[n++],l.push("M"),u.push(a,o),i=a,s=o;else if("L"==f)a=m+e[n++],o=y+e[n++],l.push("L"),u.push(a,o);else if("H"==f)a=m+e[n++],l.push("L"),u.push(a,o);else if("V"==f)o=y+e[n++],l.push("L"),u.push(a,o);else if("C"==f){var g=m+e[n++],b=y+e[n++],x=m+e[n++],w=y+e[n++],S=m+e[n++],U=y+e[n++];l.push("C"),u.push(g,b,x,w,S,U),a=S,o=U}else if("S"==f){var _=Math.max(u.length-4,0);g=a+a-u[_],b=o+o-u[_+1],x=m+e[n++],w=y+e[n++],S=m+e[n++],U=y+e[n++],l.push("C"),u.push(g,b,x,w,S,U),a=S,o=U}else console.log("Unknown SVG command "+h)}}},t.SVG._reps=function(e,t,r){for(var n=t;n<e.length&&"string"!=typeof e[n];)n+=r;return(n-t)/r},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,n=-1;if(null!=r.p0e4?n=r.p0e4:null!=r.p3e1?n=r.p3e1:null!=r.p1e0?n=r.p1e0:null!=r.p0e3&&(n=r.p0e3),-1==n)throw"no familiar platform and encoding!";var a=r.tables[n];if(0==a.format)return t>=a.map.length?0:a.map[t];if(4==a.format){for(var o=-1,i=0;i<a.endCount.length;i++)if(t<=a.endCount[i]){o=i;break}return-1==o||a.startCount[o]>t?0:65535&(0!=a.idRangeOffset[o]?a.glyphIdArray[t-a.startCount[o]+(a.idRangeOffset[o]>>1)-(a.idRangeOffset.length-o)]:t+a.idDelta[o])}if(12==a.format){if(t>a.groups[a.groups.length-1][1])return 0;for(i=0;i<a.groups.length;i++){var s=a.groups[i];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+a.format},t.U.glyphToPath=function(e,r){var n={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var a=e.SVG.entries[r];return null==a?n:("string"==typeof a&&(a=t.SVG.toPath(a),e.SVG.entries[r]=a),a)}if(e.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},i=e.CFF,s=e.CFF.Private;if(i.ROS){for(var c=0;i.FDSelect[c+2]<=r;)c+=2;s=i.FDArray[i.FDSelect[c+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],o,i,s,n)}else e.glyf&&t.U._drawGlyf(r,e,n);return n},t.U._drawGlyf=function(e,r,n){var a=r.glyf[e];null==a&&(a=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=a&&(a.noc>-1?t.U._simpleGlyph(a,n):t.U._compoGlyph(a,r,n))},t.U._simpleGlyph=function(e,r){for(var n=0;n<e.noc;n++){for(var a=0==n?0:e.endPts[n-1]+1,o=e.endPts[n],i=a;i<=o;i++){var s=i==a?o:i-1,c=i==o?a:i+1,l=1&e.flags[i],u=1&e.flags[s],h=1&e.flags[c],f=e.xs[i],d=e.ys[i];if(i==a)if(l){if(!u){t.U.P.moveTo(r,f,d);continue}t.U.P.moveTo(r,e.xs[s],e.ys[s])}else u?t.U.P.moveTo(r,e.xs[s],e.ys[s]):t.U.P.moveTo(r,(e.xs[s]+f)/2,(e.ys[s]+d)/2);l?u&&t.U.P.lineTo(r,f,d):h?t.U.P.qcurveTo(r,f,d,e.xs[c],e.ys[c]):t.U.P.qcurveTo(r,f,d,(f+e.xs[c])/2,(d+e.ys[c])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,n){for(var a=0;a<e.parts.length;a++){var o={cmds:[],crds:[]},i=e.parts[a];t.U._drawGlyf(i.glyphIndex,r,o);for(var s=i.m,c=0;c<o.crds.length;c+=2){var l=o.crds[c],u=o.crds[c+1];n.crds.push(l*s.a+u*s.b+s.tx),n.crds.push(l*s.c+u*s.d+s.ty)}for(c=0;c<o.cmds.length;c++)n.cmds.push(o.cmds[c])}},t.U._getGlyphClass=function(e,r){var n=t._lctf.getInterval(r,e);return-1==n?0:r[n+2]},t.U.getPairAdjustment=function(e,r,n){if(e.GPOS)for(var a=e.GPOS,o=a.lookupList,i=a.featureList,s=[],c=0;c<i.length;c++){var l=i[c];if("kern"==l.tag)for(var u=0;u<l.tab.length;u++)if(!s[l.tab[u]]){s[l.tab[u]]=!0;for(var h=o[l.tab[u]],f=0;f<h.tabs.length;f++)if(null!=h.tabs[c]){var d,v=h.tabs[f];if(!v.coverage||-1!=(d=t._lctf.coverageIndex(v.coverage,r)))if(1==h.ltype);else if(2==h.ltype){var p;if(1==v.fmt){var m=v.pairsets[d];for(c=0;c<m.length;c++)m[c].gid2==n&&(p=m[c])}else if(2==v.fmt){var y=t.U._getGlyphClass(r,v.classDef1),g=t.U._getGlyphClass(n,v.classDef2);p=v.matrix[y][g]}if(p&&p.val2)return p.val2[2]}}}}if(e.kern){var b=e.kern.glyph1.indexOf(r);if(-1!=b){var x=e.kern.rval[b].glyph2.indexOf(n);if(-1!=x)return e.kern.rval[b].vals[x]}}return 0},t.U.stringToGlyphs=function(e,r){for(var n=[],a=0;a<r.length;a++)(o=r.codePointAt(a))>65535&&a++,n.push(t.U.codeToGlyph(e,o));for(a=0;a<r.length;a++){var o;if(2367==(o=r.codePointAt(a))){var i=n[a-1];n[a-1]=n[a],n[a]=i}o>65535&&a++}var s=e.GSUB;if(null==s)return n;for(var c=s.lookupList,l=s.featureList,u=["rlig","liga","mset","isol","init","fina","medi","half","pres","blws"],h=[],f=0;f<l.length;f++){var d=l[f];if(-1!=u.indexOf(d.tag))for(var v=0;v<d.tab.length;v++)if(!h[d.tab[v]]){h[d.tab[v]]=!0;for(var p=c[d.tab[v]],m=0;m<n.length;m++){var y=t.U._getWPfeature(r,m);-1!="isol,init,fina,medi".indexOf(d.tag)&&d.tag!=y||t.U._applySubs(n,m,p,c)}}}return n},t.U._getWPfeature=function(e,t){var r='\n\t" ,.:;!?()  \u060c',n="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac",a=0==t||-1!=r.indexOf(e[t-1]),o=t==e.length-1||-1!=r.indexOf(e[t+1]);return a||-1==n.indexOf(e[t-1])||(a=!0),o||-1==n.indexOf(e[t])||(o=!0),o||-1=="\ua872\u0acd\u0ad7".indexOf(e[t+1])||(o=!0),a||-1=="\ua872\u0acd\u0ad7".indexOf(e[t])||(a=!0),a?o?"isol":"init":o?"fina":"medi"},t.U._applySubs=function(e,r,n,a){for(var o=e.length-r-1,i=0;i<n.tabs.length;i++)if(null!=n.tabs[i]){var s,c=n.tabs[i];if(!c.coverage||-1!=(s=t._lctf.coverageIndex(c.coverage,e[r])))if(1==n.ltype)e[r],1==c.fmt?e[r]=e[r]+c.delta:e[r]=c.newg[s];else if(4==n.ltype)for(var l=c.vals[s],u=0;u<l.length;u++){var h=l[u],f=h.chain.length;if(!(f>o)){for(var d=!0,v=0,p=0;p<f;p++){for(;-1==e[r+v+(1+p)];)v++;h.chain[p]!=e[r+v+(1+p)]&&(d=!1)}if(d){for(e[r]=h.nglyph,p=0;p<f+v;p++)e[r+p+1]=-1;break}}}else if(5==n.ltype&&2==c.fmt)for(var m=t._lctf.getInterval(c.cDef,e[r]),y=c.cDef[m+2],g=c.scset[y],b=0;b<g.length;b++){var x=g[b],w=x.input;if(!(w.length>o)){for(d=!0,p=0;p<w.length;p++){var S=t._lctf.getInterval(c.cDef,e[r+1+p]);if(-1==m&&c.cDef[S+2]!=w[p]){d=!1;break}}if(d){var U=x.substLookupRecords;for(u=0;u<U.length;u+=2)U[u],U[u+1]}}}else if(6==n.ltype&&3==c.fmt){if(!t.U._glsCovered(e,c.backCvg,r-c.backCvg.length))continue;if(!t.U._glsCovered(e,c.inptCvg,r))continue;if(!t.U._glsCovered(e,c.ahedCvg,r+c.inptCvg.length))continue;var _=c.lookupRec;for(b=0;b<_.length;b+=2){m=_[b];var M=a[_[b+1]];t.U._applySubs(e,r+m,M,a)}}}},t.U._glsCovered=function(e,r,n){for(var a=0;a<r.length;a++)if(-1==t._lctf.coverageIndex(r[a],e[n+a]))return!1;return!0},t.U.glyphsToPath=function(e,r,n){for(var a={cmds:[],crds:[]},o=0,i=0;i<r.length;i++){var s=r[i];if(-1!=s){for(var c=i<r.length-1&&-1!=r[i+1]?r[i+1]:0,l=t.U.glyphToPath(e,s),u=0;u<l.crds.length;u+=2)a.crds.push(l.crds[u]+o),a.crds.push(l.crds[u+1]);for(n&&a.cmds.push(n),u=0;u<l.cmds.length;u++)a.cmds.push(l.cmds[u]);n&&a.cmds.push("X"),o+=e.hmtx.aWidth[s],i<r.length-1&&(o+=t.U.getPairAdjustment(e,s,c))}}return a},t.U.pathToSVG=function(e,t){null==t&&(t=5);for(var r=[],n=0,a={M:2,L:2,Q:4,C:6},o=0;o<e.cmds.length;o++){var i=e.cmds[o],s=n+(a[i]?a[i]:0);for(r.push(i);n<s;){var c=e.crds[n++];r.push(parseFloat(c.toFixed(t))+(n==s?"":" "))}}return r.join("")},t.U.pathToContext=function(e,t){for(var r=0,n=e.crds,a=0;a<e.cmds.length;a++){var o=e.cmds[a];"M"==o?(t.moveTo(n[r],n[r+1]),r+=2):"L"==o?(t.lineTo(n[r],n[r+1]),r+=2):"C"==o?(t.bezierCurveTo(n[r],n[r+1],n[r+2],n[r+3],n[r+4],n[r+5]),r+=6):"Q"==o?(t.quadraticCurveTo(n[r],n[r+1],n[r+2],n[r+3]),r+=4):"#"==o.charAt(0)?(t.beginPath(),t.fillStyle=o):"Z"==o?t.closePath():"X"==o&&t.fill()}},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,n,a,o,i){e.cmds.push("C"),e.crds.push(t,r,n,a,o,i)},t.U.P.qcurveTo=function(e,t,r,n,a){e.cmds.push("Q"),e.crds.push(t,r,n,a)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,n,a,o){for(var i=r.stack,s=r.nStems,c=r.haveWidth,l=r.width,u=r.open,h=0,f=r.x,d=r.y,v=0,p=0,m=0,y=0,g=0,b=0,x=0,w=0,S=0,U=0,_={val:0,size:0};h<e.length;){t.CFF.getCharString(e,h,_);var M=_.val;if(h+=_.size,"o1"==M||"o18"==M)i.length%2!==0&&!c&&(l=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,c=!0;else if("o3"==M||"o23"==M)i.length%2!==0&&!c&&(l=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,c=!0;else if("o4"==M)i.length>1&&!c&&(l=i.shift()+a.nominalWidthX,c=!0),u&&t.U.P.closePath(o),d+=i.pop(),t.U.P.moveTo(o,f,d),u=!0;else if("o5"==M)for(;i.length>0;)f+=i.shift(),d+=i.shift(),t.U.P.lineTo(o,f,d);else if("o6"==M||"o7"==M)for(var A=i.length,E="o6"==M,T=0;T<A;T++){var C=i.shift();E?f+=C:d+=C,E=!E,t.U.P.lineTo(o,f,d)}else if("o8"==M||"o24"==M){A=i.length;for(var D=0;D+6<=A;)v=f+i.shift(),p=d+i.shift(),m=v+i.shift(),y=p+i.shift(),f=m+i.shift(),d=y+i.shift(),t.U.P.curveTo(o,v,p,m,y,f,d),D+=6;"o24"==M&&(f+=i.shift(),d+=i.shift(),t.U.P.lineTo(o,f,d))}else{if("o11"==M)break;if("o1234"==M||"o1235"==M||"o1236"==M||"o1237"==M)"o1234"==M&&(p=d,m=(v=f+i.shift())+i.shift(),U=y=p+i.shift(),b=y,w=d,f=(x=(g=(S=m+i.shift())+i.shift())+i.shift())+i.shift(),t.U.P.curveTo(o,v,p,m,y,S,U),t.U.P.curveTo(o,g,b,x,w,f,d)),"o1235"==M&&(v=f+i.shift(),p=d+i.shift(),m=v+i.shift(),y=p+i.shift(),S=m+i.shift(),U=y+i.shift(),g=S+i.shift(),b=U+i.shift(),x=g+i.shift(),w=b+i.shift(),f=x+i.shift(),d=w+i.shift(),i.shift(),t.U.P.curveTo(o,v,p,m,y,S,U),t.U.P.curveTo(o,g,b,x,w,f,d)),"o1236"==M&&(v=f+i.shift(),p=d+i.shift(),m=v+i.shift(),U=y=p+i.shift(),b=y,x=(g=(S=m+i.shift())+i.shift())+i.shift(),w=b+i.shift(),f=x+i.shift(),t.U.P.curveTo(o,v,p,m,y,S,U),t.U.P.curveTo(o,g,b,x,w,f,d)),"o1237"==M&&(v=f+i.shift(),p=d+i.shift(),m=v+i.shift(),y=p+i.shift(),S=m+i.shift(),U=y+i.shift(),g=S+i.shift(),b=U+i.shift(),x=g+i.shift(),w=b+i.shift(),Math.abs(x-f)>Math.abs(w-d)?f=x+i.shift():d=w+i.shift(),t.U.P.curveTo(o,v,p,m,y,S,U),t.U.P.curveTo(o,g,b,x,w,f,d));else if("o14"==M){if(i.length>0&&!c&&(l=i.shift()+n.nominalWidthX,c=!0),4==i.length){var k=i.shift(),O=i.shift(),P=i.shift(),L=i.shift(),F=t.CFF.glyphBySE(n,P),I=t.CFF.glyphBySE(n,L);t.U._drawCFF(n.CharStrings[F],r,n,a,o),r.x=k,r.y=O,t.U._drawCFF(n.CharStrings[I],r,n,a,o)}u&&(t.U.P.closePath(o),u=!1)}else if("o19"==M||"o20"==M)i.length%2!==0&&!c&&(l=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,c=!0,h+=s+7>>3;else if("o21"==M)i.length>2&&!c&&(l=i.shift()+a.nominalWidthX,c=!0),d+=i.pop(),f+=i.pop(),u&&t.U.P.closePath(o),t.U.P.moveTo(o,f,d),u=!0;else if("o22"==M)i.length>1&&!c&&(l=i.shift()+a.nominalWidthX,c=!0),f+=i.pop(),u&&t.U.P.closePath(o),t.U.P.moveTo(o,f,d),u=!0;else if("o25"==M){for(;i.length>6;)f+=i.shift(),d+=i.shift(),t.U.P.lineTo(o,f,d);v=f+i.shift(),p=d+i.shift(),m=v+i.shift(),y=p+i.shift(),f=m+i.shift(),d=y+i.shift(),t.U.P.curveTo(o,v,p,m,y,f,d)}else if("o26"==M)for(i.length%2&&(f+=i.shift());i.length>0;)v=f,p=d+i.shift(),f=m=v+i.shift(),d=(y=p+i.shift())+i.shift(),t.U.P.curveTo(o,v,p,m,y,f,d);else if("o27"==M)for(i.length%2&&(d+=i.shift());i.length>0;)p=d,m=(v=f+i.shift())+i.shift(),y=p+i.shift(),f=m+i.shift(),d=y,t.U.P.curveTo(o,v,p,m,y,f,d);else if("o10"==M||"o29"==M){var B="o10"==M?a:n;if(0==i.length)console.log("error: empty stack");else{var R=i.pop(),z=B.Subrs[R+B.Bias];r.x=f,r.y=d,r.nStems=s,r.haveWidth=c,r.width=l,r.open=u,t.U._drawCFF(z,r,n,a,o),f=r.x,d=r.y,s=r.nStems,c=r.haveWidth,l=r.width,u=r.open}}else if("o30"==M||"o31"==M){var j=i.length,G=(D=0,"o31"==M);for(D+=j-(A=-3&j);D<A;)G?(p=d,m=(v=f+i.shift())+i.shift(),d=(y=p+i.shift())+i.shift(),A-D==5?(f=m+i.shift(),D++):f=m,G=!1):(v=f,p=d+i.shift(),m=v+i.shift(),y=p+i.shift(),f=m+i.shift(),A-D==5?(d=y+i.shift(),D++):d=y,G=!0),t.U.P.curveTo(o,v,p,m,y,f,d),D+=4}else{if("o"==(M+"").charAt(0))throw console.log("Unknown operation: "+M,e),M;i.push(M)}}}r.x=f,r.y=d,r.nStems=s,r.haveWidth=c,r.width=l,r.open=u},t},function(){var e=function(){var e={};function t(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function r(e,r){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=r,this.destLen=0,this.ltree=new t,this.dtree=new t}var n=new t,a=new t,o=new Uint8Array(30),i=new Uint16Array(30),s=new Uint8Array(30),c=new Uint16Array(30),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new t,h=new Uint8Array(320);function f(e,t,r,n){var a,o;for(a=0;a<r;++a)e[a]=0;for(a=0;a<30-r;++a)e[a+r]=a/r|0;for(o=n,a=0;a<30;++a)t[a]=o,o+=1<<e[a]}var d=new Uint16Array(16);function v(e,t,r,n){var a,o;for(a=0;a<16;++a)e.table[a]=0;for(a=0;a<n;++a)e.table[t[r+a]]++;for(e.table[0]=0,o=0,a=0;a<16;++a)d[a]=o,o+=e.table[a];for(a=0;a<n;++a)t[r+a]&&(e.trans[d[t[r+a]]++]=a)}function p(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function m(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var n=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,n+r}function y(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,n=0,a=0,o=e.tag;do{n=2*n+(1&o),o>>>=1,++a,r+=t.table[a],n-=t.table[a]}while(n>=0);return e.tag=o,e.bitcount-=a,t.trans[r+n]}function g(e,t,r){var n,a,o,i,s,c;for(n=m(e,5,257),a=m(e,5,1),o=m(e,4,4),i=0;i<19;++i)h[i]=0;for(i=0;i<o;++i){var f=m(e,3,0);h[l[i]]=f}for(v(u,h,0,19),s=0;s<n+a;){var d=y(e,u);switch(d){case 16:var p=h[s-1];for(c=m(e,2,3);c;--c)h[s++]=p;break;case 17:for(c=m(e,3,3);c;--c)h[s++]=0;break;case 18:for(c=m(e,7,11);c;--c)h[s++]=0;break;default:h[s++]=d}}v(t,h,0,n),v(r,h,n,a)}function b(e,t,r){for(;;){var n,a,l,u,h=y(e,t);if(256===h)return 0;if(h<256)e.dest[e.destLen++]=h;else for(n=m(e,o[h-=257],i[h]),a=y(e,r),u=l=e.destLen-m(e,s[a],c[a]);u<l+n;++u)e.dest[e.destLen++]=e.dest[u]}}function x(e){for(var t,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return-3;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,0}return function(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}(n,a),f(o,i,4,3),f(s,c,2,1),o[28]=0,i[28]=258,e.exports=function(e,t){var o,i,s=new r(e,t);do{switch(o=p(s),m(s,2,0)){case 0:i=x(s);break;case 1:i=b(s,n,a);break;case 2:g(s,s.ltree,s.dtree),i=b(s,s.ltree,s.dtree);break;default:i=-3}if(0!==i)throw new Error("Data error")}while(!o);return s.destLen<s.dest.length?"function"===typeof s.dest.slice?s.dest.slice(0,s.destLen):s.dest.subarray(0,s.destLen):s.dest},e.exports}();return function(t){return function(e,t){var r=new DataView(e),n=0;function a(){var e=r.getUint16(n);return n+=2,e}function o(){var e=r.getUint32(n);return n+=4,e}function i(e){g.setUint16(b,e),b+=2}function s(e){g.setUint32(b,e),b+=4}for(var c={signature:o(),flavor:o(),length:o(),numTables:a(),reserved:a(),totalSfntSize:o(),majorVersion:a(),minorVersion:a(),metaOffset:o(),metaLength:o(),metaOrigLength:o(),privOffset:o(),privLength:o()},l=0;Math.pow(2,l)<=c.numTables;)l++;l--;for(var u=16*Math.pow(2,l),h=16*c.numTables-u,f=12,d=[],v=0;v<c.numTables;v++)d.push({tag:o(),offset:o(),compLength:o(),origLength:o(),origChecksum:o()}),f+=16;var p,m=new Uint8Array(12+16*d.length+d.reduce((function(e,t){return e+t.origLength+4}),0)),y=m.buffer,g=new DataView(y),b=0;return s(c.flavor),i(c.numTables),i(u),i(l),i(h),d.forEach((function(e){s(e.tag),s(e.origChecksum),s(f),s(e.origLength),e.outOffset=f,(f+=e.origLength)%4!=0&&(f+=4-f%4)})),d.forEach((function(r){var n=e.slice(r.offset,r.offset+r.compLength);if(r.compLength!=r.origLength){var a=new Uint8Array(r.origLength);t(new Uint8Array(n,2),a)}else a=new Uint8Array(n);m.set(a,r.outOffset);var o=0;(f=r.outOffset+r.origLength)%4!=0&&(o=4-f%4),m.set(new Uint8Array(o).buffer,r.outOffset+r.origLength),p=f+o})),y.slice(0,p)}(t,e)}},function(e,t){var r={M:2,L:2,Q:4,C:6,Z:0};return function(n){var a=new Uint8Array(n,0,4),o=e._bin.readASCII(a,0,4);if("wOFF"===o)n=t(n);else if("wOF2"===o)throw new Error("woff2 fonts not supported");return function(t){var n=Object.create(null),a={unitsPerEm:t.head.unitsPerEm,ascender:t.hhea.ascender,descender:t.hhea.descender,forEachGlyph:function(o,i,s,c){var l=0,u=1/a.unitsPerEm*i,h=e.U.stringToGlyphs(t,o),f=0;return h.forEach((function(a){if(-1!==a){var h=n[a];if(!h){var d,v,p,m,y=e.U.glyphToPath(t,a),g=y.cmds,b=y.crds;if(b.length){d=v=1/0,p=m=-1/0;for(var x=0,w=b.length;x<w;x+=2){var S=b[x],U=b[x+1];S<d&&(d=S),U<v&&(v=U),S>p&&(p=S),U>m&&(m=U)}}else d=p=v=m=0;h=n[a]={index:a,advanceWidth:t.hmtx.aWidth[a],xMin:d,yMin:v,xMax:p,yMax:m,pathCommandCount:g.length,forEachPathCommand:function(e){for(var t=0,n=[],a=0,o=g.length;a<o;a++){var i=r[g[a]];n.length=1+i,n[0]=g[a];for(var s=1;s<=i;s++)n[s]=b[t++];e.apply(null,n)}}}}c.call(null,h,l,f),h.advanceWidth&&(l+=h.advanceWidth*u),s&&(l+=s*i)}f+=o.codePointAt(f)>65535?2:1})),l}};return a}(e.parse(n)[0])}}],init:function(e,t,r){return r(e(),t())}}),i={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,textureWidth:2048},s=new t.Color,c=Object.create(null);function l(e,r){if((e=u({},e)).font=(h=e.font||i.defaultFontURL,a||(a="undefined"===typeof document?{}:document.createElement("a")),a.href=h,a.href),e.text=""+e.text,null!=e.colorRanges){var n={};for(var o in e.colorRanges)if(e.colorRanges.hasOwnProperty(o)){var l=e.colorRanges[o];"number"!==typeof l&&(l=s.set(l).getHex()),n[o]=l}e.colorRanges=n}var h;Object.freeze(e);var d=i.sdfGlyphSize,v=i.textureWidth,p=c[e.font];p||((p=c[e.font]={sdfTexture:new t.DataTexture(new Uint8Array(d*v),v,d,t.LuminanceFormat,void 0,void 0,void 0,void 0,t.LinearFilter,t.LinearFilter)}).sdfTexture.font=e.font),f(e).then((function(t){t.newGlyphSDFs&&(t.newGlyphSDFs.forEach((function(e){for(var t=e.textureData,r=e.atlasIndex,n=p.sdfTexture.image;n.data.length<(r+1)*d*d;){var a=new Uint8Array(2*n.data.length);a.set(n.data),n.data=a,n.height*=2}for(var o=n.width/d,i=0;i<d;i++)for(var s=i*d,c=n.width*d*Math.floor(r/o)+r%o*d+i*n.width,l=0;l<d;l++)n.data[c+l]=t[s+l]})),p.sdfTexture.needsUpdate=!0),r(Object.freeze({parameters:e,sdfTexture:p.sdfTexture,sdfGlyphSize:d,sdfMinDistancePercent:1/8,glyphBounds:t.glyphBounds,glyphAtlasIndices:t.glyphAtlasIndices,glyphColors:t.glyphColors,caretPositions:t.caretPositions,caretHeight:t.caretHeight,chunkedBounds:t.chunkedBounds,ascender:t.ascender,descender:t.descender,lineHeight:t.lineHeight,topBaseline:t.topBaseline,totalBounds:t.totalBounds,totalBlockSize:t.totalBlockSize,timings:t.timings}))}))}function u(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var h=r.defineWorkerModule({name:"FontProcessor",dependencies:[i,1/8,o,function(e){var t=e.xMin,r=e.yMin,n=e.xMax-t,a=e.yMax-r,o={0:null,1:null,2:null,3:null,data:null,cx:Math.round(t+n/2),cy:Math.round(r+a/2),r:Math.pow(2,Math.floor(Math.log(Math.max(n,a))*Math.LOG2E)),minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};function i(e){!function e(t,r){if(!1!==r(t)&&!t.data)for(var n=0;n<4;n++)null!==t[n]&&e(t[n],r)}(o,e)}function s(e,t,r,n,a,o){var i=a-r,s=o-n,c=i*i+s*s,l=c?Math.max(0,Math.min(1,((e-r)*i+(t-n)*s)/c)):0,u=e-(r+l*i),h=t-(n+l*s);return u*u+h*h}return{addLineSegment:function(e,t,r,n){!function e(t,r){var n=t.minX,a=t.minY,o=t.maxX,i=t.maxY,s=t.cx,c=t.cy;n<r.minX&&(r.minX=n),a<r.minY&&(r.minY=a),o>r.maxX&&(r.maxX=o),i>r.maxY&&(r.maxY=i);var l=r.data;if(l)if(l.cx===s&&l.cy===c){for(;l.next;)l=l.next;l.next=t}else r.data=null,e(l,r),e(t,r);else{var u=(c<r.cy?0:2)+(s<r.cx?0:1);r[u]?e(t,r[u]):r[u]={0:null,1:null,2:null,3:null,data:t,cx:r.cx+r.r/2*(u%2?1:-1),cy:r.cy+r.r/2*(u<2?-1:1),r:r.r/2,minX:n,minY:a,maxX:o,maxY:i}}}({x0:e,y0:t,x1:r,y1:n,cx:(e+r)/2,cy:(t+n)/2,minX:Math.min(e,r),minY:Math.min(t,n),maxX:Math.max(e,r),maxY:Math.max(t,n),next:null},o)},findNearestSignedDistance:function(e,t,r){var n=r,a=n*n;return i((function(r){if(e-n>r.maxX||e+n<r.minX||t-n>r.maxY||t+n<r.minY)return!1;for(var o=r.data;o;o=o.next){var i=s(e,t,o.x0,o.y0,o.x1,o.y1);i<a&&(a=i,n=Math.sqrt(i))}})),function(e,t){var r=!1;return i((function(n){if(n.maxX<e||n.minY>t||n.maxY<t)return!1;for(var a=n.data;a;a=a.next){var o=a.x0,i=a.y0,s=a.x1,c=a.y1;i>t!==c>t&&e<(s-o)*(t-i)/(c-i)+o&&(r=!r)}})),r}(e,t)||(n=-n),n}}},function(e,t){var r=t.sdfTextureSize,n=t.sdfDistancePercent;function a(e,t,r,n,a,o,i){var s=1-i;return{x:s*s*e+2*s*i*r+i*i*a,y:s*s*t+2*s*i*n+i*i*o}}function o(e,t,r,n,a,o,i,s,c){var l=1-c;return{x:l*l*l*e+3*l*l*c*r+3*l*c*c*a+c*c*c*i,y:l*l*l*t+3*l*l*c*n+3*l*c*c*o+c*c*c*s}}return function(t){var i=new Uint8Array(r*r),s=t.xMax-t.xMin,c=t.yMax-t.yMin,l=Math.max(s,c)*n,u=(s+2*l)/r,h=(c+2*l)/r,f=t.xMin-l-u,d=t.yMin-l-h,v=t.xMax+l+u,p=t.yMax+l+h;if(t.pathCommandCount){var m,y,g,b,x=e(t);t.forEachPathCommand((function(e,t,r,n,i,s,c){switch(e){case"M":g=m=t,b=y=r;break;case"L":t===g&&r===b||x.addLineSegment(g,b,g=t,b=r);break;case"Q":for(var l={x:g,y:b},u=1;u<16;u++){var h=a(g,b,t,r,n,i,u/15);x.addLineSegment(l.x,l.y,h.x,h.y),l=h}g=n,b=i;break;case"C":for(var f={x:g,y:b},d=1;d<16;d++){var v=o(g,b,t,r,n,i,s,c,d/15);x.addLineSegment(f.x,f.y,v.x,v.y),f=v}g=s,b=c;break;case"Z":g===m&&b===y||x.addLineSegment(g,b,m,y)}}));for(var w=0;w<r;w++)for(var S=0;S<r;S++){var U=x.findNearestSignedDistance(f+(v-f)*(w+.5)/r,d+(p-d)*(S+.5)/r,l),_=isFinite(U)?Math.round(255*(1+U/l)*.5):U;_=Math.max(0,Math.min(255,_)),i[S*r+w]=_}}return{textureData:i,renderingBounds:[f,d,v,p]}}},function(e,t,r){var n=r.defaultFontUrl,a=Object.create(null);function o(t,r){t||(t=n);var o=a[t];if(o)o.onload?o.onload.push(r):r();else{var i=a[t]={onload:[r]};!function(t,r){!function a(){var o=function(e){console.error("Failure loading font "+t+(t===n?"":"; trying fallback"),e),t!==n&&(t=n,a())};try{var i=new XMLHttpRequest;i.open("get",t,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)o(new Error(i.statusText));else if(i.status>0)try{var t=e(i.response);r(t)}catch(n){o(n)}},i.onerror=o,i.send()}catch(s){o(s)}}()}(t,(function(e){o=a[t]={fontObj:e,glyphs:{},glyphCount:0},i.onload.forEach((function(e){return e()}))}))}}function i(e,r,i){var u=e.text;void 0===u&&(u="");var h=e.font;void 0===h&&(h=n);var f=e.fontSize;void 0===f&&(f=1);var d=e.letterSpacing;void 0===d&&(d=0);var v=e.lineHeight;void 0===v&&(v="normal");var p=e.maxWidth;void 0===p&&(p=1/0);var m=e.textAlign;void 0===m&&(m="left");var y=e.whiteSpace;void 0===y&&(y="normal");var g=e.overflowWrap;void 0===g&&(g="normal");var b=e.anchorX;void 0===b&&(b=0);var x=e.anchorY;void 0===x&&(x=0);var w=e.includeCaretPositions;void 0===w&&(w=!1);var S=e.chunkedBoundsSize;void 0===S&&(S=8192);var U=e.colorRanges;void 0===U&&(U=null),void 0===i&&(i=!1);var _=c(),M={total:0,fontLoad:0,layout:0,sdf:{},sdfTotal:0};u.indexOf("\r")>-1&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),u=u.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),f=+f,d=+d,p=+p,v=v||"normal",function(e,t){e||(e=n),o(e,(function(){t(a[e])}))}(h,(function(e){var n=e.fontObj,a=isFinite(p),o=null,h=null,A=null,E=null,T=null,C=null,D=null,k=0,O=0,P="nowrap"!==y,L=n.ascender,F=n.descender,I=n.unitsPerEm;M.fontLoad=c()-_;var B=c(),R=f/I;"normal"===v&&(v=(L-F)/I);var z=((v*=f)-(L-F)*R)/2,j=-(f+z),G=Math.min(v,(L-F)*R),V=(L+F)/2*R-G/2,X=0,N=new l,Y=[N];if(n.forEachGlyph(u,f,d,(function(e,t,r){var n,o=u.charAt(r),i=e.advanceWidth*R,s=N.count;if("isEmpty"in e||(e.isWhitespace=!!o&&/\s/.test(o),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax),e.isWhitespace||e.isEmpty||O++,P&&a&&!e.isWhitespace&&t+i+X>p&&s){if(N.glyphAt(s-1).glyphObj.isWhitespace)n=new l,X=-t;else for(var c=s;c--;){if(0===c&&"break-word"===g){n=new l,X=-t;break}if(N.glyphAt(c).glyphObj.isWhitespace){var h=(n=N.splitAt(c+1)).glyphAt(0).x;X-=h;for(var v=n.count;v--;)n.glyphAt(v).x-=h;break}}n&&(N.isSoftWrapped=!0,N=n,Y.push(N),k=p)}var m=N.glyphAt(N.count);m.glyphObj=e,m.x=t+X,m.width=i,m.charIndex=r,"\n"===o&&(N=new l,Y.push(N),X=-(t+i+d*f))})),Y.forEach((function(e){for(var t=e.count;t--;){var r=e.glyphAt(t),n=r.glyphObj,a=r.x,o=r.width;if(!n.isWhitespace)return e.width=a+o,void(e.width>k&&(k=e.width))}})),!i){var Z=0,H=0;if(b&&("number"===typeof b?Z=-b:"string"===typeof b&&(Z=-k*("left"===b?0:"center"===b?.5:"right"===b?1:s(b)))),x)if("number"===typeof x)H=-x;else if("string"===typeof x){var W=Y.length*v;H="top"===x?0:"top-baseline"===x?-j:"middle"===x?W/2:"bottom"===x?W:"bottom-baseline"===x?W-z+F*R:s(x)*W}h=new Float32Array(4*O),A=new Float32Array(O),C=[1/0,1/0,-1/0,-1/0],D=[];var q=j;w&&(T=new Float32Array(3*u.length)),U&&(E=new Uint8Array(3*O));var Q,K,$=0,J=-1,ee=-1;Y.forEach((function(r){var n=r.count,a=r.width;if(n>0){var i=0,s=0;if("center"===m)i=(k-a)/2;else if("right"===m)i=k-a;else if("justify"===m&&r.isSoftWrapped){for(var l=0,f=n;f--;)if(!r.glyphAt(f).glyphObj.isWhitespace){for(;f--;)r.glyphAt(f).glyphObj,r.glyphAt(f).glyphObj.isWhitespace&&l++;break}s=(k-a)/l}for(var d=0;d<n;d++){var p=r.glyphAt(d),y=p.glyphObj;if(i&&(p.x+=i),0!==s&&y.isWhitespace&&(i+=s,p.width+=s),w){var g=p.charIndex;for(T[3*g]=p.x+Z,T[3*g+1]=p.x+p.width+Z,T[3*g+2]=q+V+H;g-J>1;)T[3*(J+1)]=T[3*J+1],T[3*(J+1)+1]=T[3*J+1],T[3*(J+1)+2]=T[3*J+2],J++;J=g}if(U)for(var b=p.charIndex;b>ee;)ee++,U.hasOwnProperty(ee)&&(K=U[ee]);if(!y.isWhitespace&&!y.isEmpty){var x=$++,_=e.glyphs[y.index];if(!_){var O=c(),P=t(y);M.sdf[u.charAt(p.charIndex)]=c()-O,P.atlasIndex=e.glyphCount++,o||(o=[]),o.push(P),_=e.glyphs[y.index]={atlasIndex:P.atlasIndex,glyphObj:y,renderingBounds:P.renderingBounds}}var L=_.renderingBounds,F=4*x,I=h[F]=p.x+L[0]*R+Z,B=h[F+1]=q+L[1]*R+H,z=h[F+2]=p.x+L[2]*R+Z,j=h[F+3]=q+L[3]*R+H;if(I<C[0]&&(C[0]=I),B<C[1]&&(C[1]=B),z>C[2]&&(C[2]=z),j>C[3]&&(C[3]=j),x%S===0&&(Q={start:x,end:x,rect:[1/0,1/0,-1/0,-1/0]},D.push(Q)),Q.end++,I<Q.rect[0]&&(Q.rect[0]=I),B<Q.rect[1]&&(Q.rect[1]=B),z>Q.rect[2]&&(Q.rect[2]=z),j>Q.rect[3]&&(Q.rect[3]=j),A[x]=_.atlasIndex,U){var G=3*x;E[G]=K>>16&255,E[G+1]=K>>8&255,E[G+2]=255&K}}}}q-=v}))}for(var te in M.sdf)M.sdfTotal+=M.sdf[te];M.layout=c()-B-M.sdfTotal,M.total=c()-_,r({glyphBounds:h,glyphAtlasIndices:A,caretPositions:T,caretHeight:G,glyphColors:E,chunkedBounds:D,ascender:L*R,descender:F*R,lineHeight:v,topBaseline:j,totalBounds:C,totalBlockSize:[k,Y.length*v],newGlyphSDFs:o,timings:M})}))}function s(e){var t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function c(){return(self.performance||Date).now()}function l(){this.data=[]}return l.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/4)},glyphAt:function(e){var t=l.flyweight;return t.data=this.data,t.index=e,t},splitAt:function(e){var t=new l;return t.data=this.data.splice(4*e),t}},l.flyweight=["glyphObj","x","width","charIndex"].reduce((function(e,t,r,n){return Object.defineProperty(e,t,{get:function(){return this.data[4*this.index+r]},set:function(e){this.data[4*this.index+r]=e}}),e}),{data:null,index:0}),{process:i,measure:function(e,t){i(e,(function(e){t({width:e.totalBlockSize[0],height:e.totalBlockSize[1]})}),{metricsOnly:!0})},loadFont:o}}],init:function(e,t,r,n,a,o){return o(r,a(n,{sdfTextureSize:e.sdfGlyphSize,sdfDistancePercent:t}),{defaultFontUrl:e.defaultFontURL})}}),f=r.defineWorkerModule({name:"TextBuilder",dependencies:[h,r.ThenableWorkerModule],init:function(e,t){return function(r){var n=new t;return e.process(r,n.resolve),n}},getTransferables:function(e){var t=[e.glyphBounds.buffer,e.glyphAtlasIndices.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),e.newGlyphSDFs&&e.newGlyphSDFs.forEach((function(e){t.push(e.textureData.buffer)})),t}}),d={},v=new t.Vector3,p=function(e){function r(){e.call(this),this.detail=1,this.boundingSphere=new t.Sphere}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var n={detail:{configurable:!0}};return r.prototype.computeBoundingSphere=function(){},n.detail.set=function(e){var r=this;if(e!==this._detail){this._detail=e,("number"!==typeof e||e<1)&&(e=1);var n=function(e){var r=d[e];return r||(r=d[e]=new t.PlaneBufferGeometry(1,1,e,e).translate(.5,.5,0)),r}(e);["position","normal","uv"].forEach((function(e){r.attributes[e]=n.attributes[e]})),this.setIndex(n.getIndex())}},n.detail.get=function(){return this._detail},r.prototype.updateGlyphs=function(e,t,r,n,a){m(this,"aTroikaGlyphBounds",e,4),m(this,"aTroikaGlyphIndex",t,1),m(this,"aTroikaGlyphColor",a,3),this._chunkedBounds=n,y(this,t.length);var o=this.boundingSphere;o.center.set((r[0]+r[2])/2,(r[1]+r[3])/2,0),o.radius=o.center.distanceTo(v.set(r[0],r[1],0))},r.prototype.applyClipRect=function(e){var t=this.getAttribute("aTroikaGlyphIndex").count,r=this._chunkedBounds;if(r)for(var n=r.length;n--;){t=r[n].end;var a=r[n].rect;if(a[1]<e.w&&a[3]>e.y&&a[0]<e.z&&a[2]>e.x)break}y(this,t)},Object.defineProperties(r.prototype,n),r}(t.InstancedBufferGeometry);function m(e,r,n,a){var o=e.getAttribute(r);n?o&&o.array.length===n.length?(o.array.set(n),o.needsUpdate=!0):e.setAttribute(r,new t.InstancedBufferAttribute(n,a)):o&&e.deleteAttribute(r)}function y(e,t){e[e.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=t}p.prototype.setAttribute||(p.prototype.setAttribute=function(e,t){return this.attributes[e]=t,this});var g=new t.MeshBasicMaterial({color:16777215,side:t.DoubleSide,transparent:!0}),b=new t.Matrix4,x=new t.Vector3,w=new t.Vector3,S=new t.Vector3,U=new t.Mesh(new t.PlaneBufferGeometry(1,1).translate(.5,.5,0),g),_={type:"syncstart"},M={type:"synccomplete"},A=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","textAlign","whiteSpace","anchorX","anchorY","colorRanges"],E=A.concat("material","color","depthOffset","clipRect","orientation","glyphGeometryDetail"),T=function(e){function r(){var t=new p;e.call(this,t,null),this.text="",this.anchorX=0,this.anchorY=0,this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.depthOffset=0,this.clipRect=null,this.orientation="+x+y",this.glyphGeometryDetail=1,this.debugSDF=!1}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var a={textRenderInfo:{configurable:!0},material:{configurable:!0},glyphGeometryDetail:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};return r.prototype.sync=function(e){var t=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(_),l({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,textAlign:this.textAlign,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0},(function(r){t._isSyncing=!1,t._textRenderInfo=r,t.geometry.updateGlyphs(r.glyphBounds,r.glyphAtlasIndices,r.totalBounds,r.chunkedBounds,r.glyphColors);var n=t._queuedSyncs;n&&(t._queuedSyncs=null,t._needsSync=!0,t.sync((function(){n.forEach((function(e){return e&&e()}))}))),t.dispatchEvent(M),e&&e()}))))},r.prototype.onBeforeRender=function(){this.sync(),this._prepareForRender()},r.prototype.dispose=function(){this.geometry.dispose()},a.textRenderInfo.get=function(){return this._textRenderInfo||null},a.material.get=function(){var e=this._derivedMaterial,r=this._baseMaterial||g;return e&&e.baseMaterial===r||(e&&e.dispose(),e=this._derivedMaterial=function(e){var r=n.createDerivedMaterial(e,{extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new t.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFMinDistancePct:{value:0},uTroikaTotalBounds:{value:new t.Vector4(0,0,0,0)},uTroikaClipRect:{value:new t.Vector4(0,0,0,0)},uTroikaOrient:{value:new t.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\nvarying vec3 vTroikaGlyphColor;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nvec4 clippedBounds = vec4(\n  clamp(bounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(bounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\nvTroikaGlyphUV = clippedXY.xy;\n\nfloat cols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvTroikaSDFTextureUV = vec2(\n  mod(aTroikaGlyphIndex, cols) + clippedXY.x,\n  floor(aTroikaGlyphIndex / cols) + clippedXY.y\n) * uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = vec2(\n  (position.x - uTroikaTotalBounds.x) / (uTroikaTotalBounds.z - uTroikaTotalBounds.x),\n  (position.y - uTroikaTotalBounds.y) / (uTroikaTotalBounds.w - uTroikaTotalBounds.y)\n);\n\nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform float uTroikaSDFMinDistancePct;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\n\nfloat troikaGetTextAlpha() {\n  float troikaSDFValue = texture2D(uTroikaSDFTexture, vTroikaSDFTextureUV).r;\n  \n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(0.5, troikaSDFValue);\n  #else\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aaDist = min(\n    0.5,\n    0.5 * min(\n      fwidth(vTroikaGlyphUV.x),\n      fwidth(vTroikaGlyphUV.y)\n    )\n  ) / uTroikaSDFMinDistancePct;\n  #else\n  float aaDist = 0.01;\n  #endif\n  \n  float alpha = uTroikaSDFDebug ? troikaSDFValue : smoothstep(\n    0.5 - aaDist,\n    0.5 + aaDist,\n    troikaSDFValue\n  );\n  #endif\n  \n  return alpha;\n}\n",fragmentColorTransform:"\nfloat troikaAlphaMult = troikaGetTextAlpha();\nif (troikaAlphaMult == 0.0) {\n  discard;\n} else {\n  gl_FragColor.a *= troikaAlphaMult;\n}\n",customRewriter:function(e){var t=e.vertexShader,r=e.fragmentShader,a=/\buniform\s+vec3\s+diffuse\b/;return a.test(r)&&(r=r.replace(a,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),a.test(t)||(t=t.replace(n.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:r}}});return r.transparent=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}}),r}(r),r.addEventListener("dispose",(function t(){r.removeEventListener("dispose",t),e.dispose()}))),e},a.material.set=function(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e},a.glyphGeometryDetail.get=function(){return this.geometry.detail},a.glyphGeometryDetail.set=function(e){this.geometry.detail=e},a.customDepthMaterial.get=function(){return this.material.getDepthMaterial()},a.customDistanceMaterial.get=function(){return this.material.getDistanceMaterial()},r.prototype._prepareForRender=function(){var e=this._derivedMaterial,t=e.uniforms,r=this.textRenderInfo;if(r){var n=r.sdfTexture,a=r.totalBounds;t.uTroikaSDFTexture.value=n,t.uTroikaSDFTextureSize.value.set(n.image.width,n.image.height),t.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,t.uTroikaSDFMinDistancePct.value=r.sdfMinDistancePercent,t.uTroikaTotalBounds.value.fromArray(a),t.uTroikaUseGlyphColors.value=!!r.glyphColors;var o=this.clipRect;o&&Array.isArray(o)&&4===o.length?t.uTroikaClipRect.value.set(Math.max(a[0],o[0]),Math.max(a[1],o[1]),Math.min(a[2],o[2]),Math.min(a[3],o[3])):t.uTroikaClipRect.value.fromArray(a),this.geometry.applyClipRect(t.uTroikaClipRect.value)}t.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;var i=this.color;null!=i&&e.color&&e.color.isColor&&i!==e._troikaColor&&e.color.set(e._troikaColor=i);var s=this.orientation||"+x+y";if(s!==e._orientation){var c=t.uTroikaOrient.value,l="+x+y"!==(s=s.replace(/[^-+xyz]/g,""))&&s.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){var u=l[1],h=l[2],f=l[3],d=l[4];x.set(0,0,0)[h]="-"===u?1:-1,w.set(0,0,0)[d]="-"===f?-1:1,b.lookAt(S,x.cross(w),w),c.setFromMatrix4(b)}else c.identity();e._orientation=s}},r.prototype.raycast=function(e,t){var r=this.textRenderInfo;if(r){var n=r.totalBounds;U.matrixWorld.multiplyMatrices(this.matrixWorld,b.set(n[2]-n[0],0,0,n[0],0,n[3]-n[1],0,n[1],0,0,1,0,0,0,0,1)),U.raycast(e,t)}},r.prototype.copy=function(t){var r=this;return e.prototype.copy.call(this,t),E.forEach((function(e){r[e]=t[e]})),this},r.prototype.clone=function(){return(new this.constructor).copy(this)},Object.defineProperties(r.prototype,a),r}(t.Mesh);A.forEach((function(e){var t="_private_"+e;Object.defineProperty(T.prototype,e,{get:function(){return this[t]},set:function(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}));var C=!1;Object.defineProperty(T.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(e){this._deprecated_anchor=e,C||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),C=!0),Array.isArray(e)?(this.anchorX=100*(+e[0]||0)+"%",this.anchorY=100*(+e[1]||0)+"%"):this.anchorX=this.anchorY=0}});var D=new WeakMap,k=new WeakMap;e.GlyphsGeometry=p,e.TextMesh=T,e.configureTextBuilder=function(e){u(i,e)},e.fontProcessorWorkerModule=h,e.getCaretAtPoint=function(e,t,r){var n=null,a=e.caretHeight,o=function(e){var t=k.get(e);if(!t){var r=e.caretPositions,n=e.caretHeight;t=new Map;for(var a=0;a<r.length;a+=3){var o=r[a+2],i=t.get(o);i||t.set(o,i=[]),i.push({x:r[a],y:o,height:n,charIndex:a/3}),a+3>=r.length&&i.push({x:r[a+1],y:o,height:n,charIndex:a/3+1})}}return k.set(e,t),t}(e),i=1/0;return o.forEach((function(e,t){Math.abs(r-(t+a/2))<Math.abs(r-(i+a/2))&&(i=t)})),o.get(i).forEach((function(e){(!n||Math.abs(t-e.x)<Math.abs(t-n.x))&&(n=e)})),n},e.getSelectionRects=function(e,t,r){var n;if(e){var a=D.get(e);if(a&&a.start===t&&a.end===r)return a.rects;var o=e.caretPositions,i=e.caretHeight,s=e.totalBounds;if(r<t){var c=t;t=r,r=c}t=Math.max(t,0),r=Math.min(r,o.length+1);for(var l=new Map,u=t;u<r;u++){var h=o[3*u],f=o[3*u+1],d=o[3*u+2],v=l.get(d);v?(v.left=Math.max(Math.min(v.left,h),s[0]),v.right=Math.min(Math.max(v.right,f),s[2])):(v={left:h,right:f,bottom:d,top:d+i},l.set(d,v))}n=[],l.forEach((function(e){n.push(e)})),D.set(e,{start:t,end:r,rects:n})}return n},e.preloadFont=function(e,t,r){l({font:e,text:Array.isArray(t)?t.join("\n"):""+t},r)},Object.defineProperty(e,"__esModule",{value:!0})}(t,r(72),r(250),r(251))},250:function(e,t,r){!function(e){"use strict";function t(){var e,r=0,n=[],a=0,o=0,i=d((function(e){o||c(1,e)})),s=d((function(e){o||c(-1,e)}));function c(t,n){o++;var a=0;try{n===m&&v();var i=t>0&&f(n);i?i.call(n,d((function(e){a++,c(1,e)})),d((function(e){a++,c(-1,e)}))):(r=t,e=n,l())}catch(s){r||a||c(-1,s)}}function l(){a||(setTimeout(u,0),a=1)}function u(){var e=n;a=0,n=[],e.forEach(h)}function h(e){e()}function f(e){var t=e&&(p(e)||"object"===typeof e)&&e.then;return p(t)&&t}function d(e){var t=0;return function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];t++||e.apply(this,r)}}function v(){throw new TypeError("Chaining cycle detected")}var p=function(e){return"function"===typeof e},m={then:function(a,o){var i=t();return n.push((function(){var t=r>0?a:o;if(p(t))try{var n=t(e);n===i&&v();var s=f(n);s?s.call(n,i.resolve,i.reject):i.resolve(n)}catch(c){i.reject(c)}else i[r>0?"resolve":"reject"](e)})),r&&l(),i},resolve:i,reject:s};return m}function r(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return{then:r.then.bind(r),resolve:e,reject:t}}t.all=r.all=function(e){var t=0,r=[],a=n();return 0===e.length?a.resolve([]):e.forEach((function(o,i){var s=n();s.resolve(o),s.then((function(n){t++,r[i]=n,t===e.length&&a.resolve(r)}),a.reject)})),a};var n="function"===typeof Promise?r:t;function a(){var e=Object.create(null);function t(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var n=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(n)}catch(a){console.error(a)}return URL.revokeObjectURL(n),delete self.troikaDefine,r}self.addEventListener("message",(function(r){var n=r.data,a=n.messageId,o=n.action,i=n.data;try{"registerModule"===o&&function r(n,a){var o=n.id,i=n.name,s=n.dependencies;void 0===s&&(s=[]);var c=n.init;void 0===c&&(c=function(){});var l=n.getTransferables;if(void 0===l&&(l=null),!e[o])try{s=s.map((function(t){return t&&t.isWorkerModule&&(r(t,(function(e){if(e instanceof Error)throw e})),t=e[t.id].value),t})),c=t("<"+i+">.init",c),l&&(l=t("<"+i+">.getTransferables",l));var u=null;"function"===typeof c?u=c.apply(void 0,s):console.error("worker module init function failed to rehydrate"),e[o]={id:o,value:u,getTransferables:l},a(u)}catch(h){h&&h.noLog||console.error(h),a(h)}}(i,(function(e){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:{isCallable:"function"===typeof e}})})),"callModule"===o&&function(t,r){var n,a=t.id,o=t.args;e[a]&&"function"===typeof e[a].value||r(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var i=(n=e[a]).value.apply(n,o);i&&"function"===typeof i.then?i.then(s,(function(e){return r(e instanceof Error?e:new Error(""+e))})):s(i)}catch(c){r(c)}function s(t){try{var n=e[a].getTransferables&&e[a].getTransferables(t);n&&Array.isArray(n)&&n.length||(n=void 0),r(t,n)}catch(c){console.error(c),r(c)}}}(i,(function(e,t){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:e},t||void 0)}))}catch(s){postMessage({messageId:a,success:!1,error:s.stack})}}))}var o=function(){var e=!1;if("undefined"!==typeof window&&"undefined"!==typeof window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){console.warn("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return o=function(){return e},e},i=0,s=0,c=!1,l=Object.create(null),u=Object.create(null);function h(e){if((!e||"function"!==typeof e.init)&&!c)throw new Error("requires `options.init` function");var t=e.dependencies,r=e.init,a=e.getTransferables,s=e.workerId;if(!o())return function(e){var t=function e(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return e._getInitResult().then((function(e){if("function"===typeof e)return e.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var r=e.dependencies,a=e.init;r=Array.isArray(r)?r.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var o=n.all(r).then((function(e){return a.apply(null,e)}));return t._getInitResult=function(){return o},o},t}(e);null==s&&(s="#default");var l="workerModule"+ ++i,u=e.name||l,v=null;function p(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return v||(v=d(s,"registerModule",p.workerModuleData)),v.then((function(t){if(t.isCallable)return d(s,"callModule",{id:l,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!==typeof e||e.workerModuleData||(c=!0,e=h({workerId:s,name:"<"+u+"> function dependency: "+e.name,init:"function(){return (\n"+f(e)+"\n)}"}),c=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),p.workerModuleData={isWorkerModule:!0,id:l,name:u,dependencies:t,init:f(r),getTransferables:a&&f(a)},p}function f(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function d(e,t,r){var o=n(),i=++s;return u[i]=function(e){e.success?o.resolve(e.result):o.reject(new Error("Error in worker "+t+" call: "+e.error))},u._count++,u.count>1e3&&console.warn("Large number of open WorkerModule requests, some may not be returning"),function(e){var t=l[e];if(!t){var r=f(a);(t=l[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,n=u[r];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete u[r],u.count--,n(t)}}return t}(e).postMessage({messageId:i,action:t,data:r}),o}u._count=0;var v=h({name:"Thenable",dependencies:[n],init:function(e){return e}});e.Thenable=n,e.ThenableWorkerModule=v,e.defineWorkerModule=h,e.stringifyFunction=f,Object.defineProperty(e,"__esModule",{value:!0})}(t)},251:function(e,t,r){!function(e,t){"use strict";var r=/\bvoid\s+main\s*\(\s*\)\s*{/g;function n(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,r){var a=t.ShaderChunk[r];return a?n(a):e}))}var a=Object.assign||function(){for(var e=arguments,t=arguments[0],r=1,n=arguments.length;r<n;r++){var a=e[r];if(a)for(var o in a)a.hasOwnProperty(o)&&(t[o]=a[o])}return t},o=0,i=Date.now(),s=new WeakMap;function c(e,r){var h=function(e){return JSON.stringify(e,u)}(r),f=s.get(e);if(f||(f=Object.create(null),s.set(e,f)),f[h])return f[h].clone();var d,v,p=++o,m="_derivedShaders"+p,y="_onBeforeCompile"+p;function g(t){e.onBeforeCompile.call(this,t);var o=this[m]||(this[m]={vertex:{},fragment:{}}),s=o.vertex,c=o.fragment;if(s.source!==t.vertexShader||c.source!==t.fragmentShader){var u=function(e,t,r){var a=e.vertexShader,o=e.fragmentShader,i=t.vertexDefs,s=t.vertexMainIntro,c=t.vertexMainOutro,u=t.vertexTransform,h=t.fragmentDefs,f=t.fragmentMainIntro,d=t.fragmentMainOutro,v=t.fragmentColorTransform,p=t.customRewriter,m=t.timeUniform;if(i=i||"",s=s||"",c=c||"",h=h||"",f=f||"",d=d||"",(u||p)&&(a=n(a)),(v||p)&&(o=n(o=o.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),p){var y=p({vertexShader:a,fragmentShader:o});a=y.vertexShader,o=y.fragmentShader}if(v){var g=[];o=o.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(function(e){return g.push(e),""})),d=v+"\n"+g.join("\n")+"\n"+d}if(m){var b="\nuniform float "+m+";\n";i=b+i,h=b+h}return u&&(i=i+"\nvec3 troika_position_"+r+";\nvec3 troika_normal_"+r+";\nvec2 troika_uv_"+r+";\nvoid troikaVertexTransform"+r+"(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  "+u+"\n}\n",s="\ntroika_position_"+r+" = vec3(position);\ntroika_normal_"+r+" = vec3(normal);\ntroika_uv_"+r+" = vec2(uv);\ntroikaVertexTransform"+r+"(troika_position_"+r+", troika_normal_"+r+", troika_uv_"+r+");\n"+s+"\n",a=a.replace(/\b(position|normal|uv)\b/g,(function(e,t,n,a){return/\battribute\s+vec[23]\s+$/.test(a.substr(0,n))?t:"troika_"+t+"_"+r}))),a=l(a,r,i,s,c),o=l(o,r,h,f,d),{vertexShader:a,fragmentShader:o}}(t,r,p);s.source=t.vertexShader,s.result=u.vertexShader,c.source=t.fragmentShader,c.result=u.fragmentShader}t.vertexShader=s.result,t.fragmentShader=c.result,a(t.uniforms,this.uniforms),r.timeUniform&&(t.uniforms[r.timeUniform]={get value(){return Date.now()-i}}),this[y]&&this[y](t)}function b(){e.constructor.apply(this,arguments),this._listeners=void 0}b.prototype=Object.create(e,{constructor:{value:b},isDerivedMaterial:{value:!0},baseMaterial:{value:e},onBeforeCompile:{get:function(){return g},set:function(e){this[y]=e}},copy:{value:function(r){return e.copy.call(this,r),e.isShaderMaterial||e.isDerivedMaterial||(this.extensions=a({},r.extensions),this.defines=a({},r.defines),this.uniforms=t.UniformsUtils.clone(r.uniforms)),this}},getDepthMaterial:{value:function(){var n=this._depthMaterial;return n||(v||((v=c(e.isDerivedMaterial?e.getDepthMaterial():new t.MeshDepthMaterial({depthPacking:t.RGBADepthPacking}),r)).defines.IS_DEPTH_MATERIAL=""),(n=this._depthMaterial=v.clone()).uniforms=this.uniforms),n}},getDistanceMaterial:{value:function(){var n=this._distanceMaterial;return n||(d||((d=c(e.isDerivedMaterial?e.getDistanceMaterial():new t.MeshDistanceMaterial,r)).defines.IS_DISTANCE_MATERIAL=""),(n=this._distanceMaterial=d.clone()).uniforms=this.uniforms),n}},dispose:{value:function(){var t=this._depthMaterial,r=this._distanceMaterial;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}});var x=new b;return x.copy(e),x.uniforms=a(t.UniformsUtils.clone(e.uniforms||{}),r.uniforms),x.defines=a({},e.defines,r.defines),x.defines.TROIKA_DERIVED_MATERIAL=p,x.extensions=a({},e.extensions,r.extensions),f[h]=x,x.clone()}function l(e,t,n,a,o){return(a||o||n)&&(e=e.replace(r,"\n"+n+"\nvoid troikaOrigMain"+t+"() {"),e+="\nvoid main() {\n  "+a+"\n  troikaOrigMain"+t+"();\n  "+o+"\n}"),e}function u(e,t){return"uniforms"===e?void 0:"function"===typeof t?t.toString():t}var h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=function(e){this.name=e,this.textureUniform="dataTex_"+e,this.textureSizeUniform="dataTexSize_"+e,this.multiplierUniform="dataMultiplier_"+e,this.dataSizeUniform="dataSize_"+e,this.readFunction="readData_"+e,this._raw=new Float32Array(0),this._texture=new t.DataTexture(new Uint8Array(0),0,1),this._length=0,this._multiplier=1},d={length:{configurable:!0}};function v(e,t,r){var n=255*e,a=n%1*255,o=a%1*255,i=o%1*255;return n&=255,a&=255,o&=255,i=255&Math.round(i),t[r]=n,t[r+1]=a,t[r+2]=o,t[r+3]=i,t}d.length.set=function(e){if(e!==this._length){var t=Math.pow(2,Math.ceil(Math.log2(e))),r=this._raw;t<r.length?this._raw=r.subarray(0,t):t>r.length&&(this._raw=new Float32Array(t),this._raw.set(r)),this._length=e}},d.length.get=function(){return this._length},f.prototype.push=function(e){return this.set(this.length++,e)},f.prototype.setArray=function(e){this.length=e.length,this._raw.set(e),this._needsRepack=!0},f.prototype.get=function(e){return this._raw[e]},f.prototype.set=function(e,t){e+1>this._length&&(this.length=e+1),t!==this._raw[e]&&(this._raw[e]=t,v(t/this._multiplier,this._texture.image.data,4*e),this._needsMultCheck=!0)},f.prototype.clone=function(){var e=new f(this.name);return e.setArray(this._raw),e},f.prototype.getShaderUniforms=function(){var e,t=this;return(e={})[this.textureUniform]={get value(){return t._sync(),t._texture}},e[this.textureSizeUniform]={get value(){return t._sync(),t._texture.image.width}},e[this.dataSizeUniform]={get value(){return t._sync(),t.length}},e[this.multiplierUniform]={get value(){return t._sync(),t._multiplier}},e},f.prototype.getShaderHeaderCode=function(){var e=this.textureUniform,t=this.textureSizeUniform,r=this.dataSizeUniform,n=this.multiplierUniform;return"\nuniform sampler2D "+e+";\nuniform float "+t+";\nuniform float "+r+";\nuniform float "+n+";\n\nfloat "+this.readFunction+"(float index) {\n  vec2 texUV = vec2((index + 0.5) / "+t+", 0.5);\n  vec4 pixel = texture2D("+e+", texUV);\n  return dot(pixel, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0)) * "+n+";\n}\n"},f.prototype._sync=function(){var e=this._texture,t=this._raw,r=this._needsRepack;if(t.length!==e.image.width&&(e.image={data:new Uint8Array(4*t.length),width:t.length,height:1},r=!0),r||this._needsMultCheck){var n=this._raw.reduce((function(e,t){return Math.max(e,t)}),0),a=Math.pow(2,Math.ceil(Math.log2(n)));a!==this._multiplier&&(this._multiplier=a,r=!0),e.needsUpdate=!0,this._needsMultCheck=!1}if(r){for(var o=0,i=t.length,s=this._multiplier;o<i;o++)v(t[o]/s,e.image.data,4*o);this._needsRepack=!1}},Object.defineProperties(f.prototype,d);var p=null,m=new t.MeshStandardMaterial({color:16777215,side:t.DoubleSide}),y=function(e){function r(){e.call(this,r.getGeometry(),m),this.pointA=new t.Vector3,this.controlA=new t.Vector3,this.controlB=new t.Vector3,this.pointB=new t.Vector3,this.radius=.01,this.dashArray=new t.Vector2,this.dashOffset=0,this.frustumCulled=!1}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var n={material:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};return r.getGeometry=function(){return p||(p=new t.CylinderBufferGeometry(1,1,1,6,64).translate(0,.5,0))},n.material.get=function(){var e=this._derivedMaterial,r=this._baseMaterial||m;return e&&e.baseMaterial===r||(e&&e.dispose(),e=this._derivedMaterial=function(e){return c(e,{uniforms:{pointA:{value:new t.Vector3},controlA:{value:new t.Vector3},controlB:{value:new t.Vector3},pointB:{value:new t.Vector3},radius:{value:.01},dashing:{value:new t.Vector3}},vertexDefs:"\nuniform vec3 pointA;\nuniform vec3 controlA;\nuniform vec3 controlB;\nuniform vec3 pointB;\nuniform float radius;\nvarying float bezierT;\n\nvec3 cubicBezier(vec3 p1, vec3 c1, vec3 c2, vec3 p2, float t) {\n  float t2 = 1.0 - t;\n  float b0 = t2 * t2 * t2;\n  float b1 = 3.0 * t * t2 * t2;\n  float b2 = 3.0 * t * t * t2;\n  float b3 = t * t * t;\n  return b0 * p1 + b1 * c1 + b2 * c2 + b3 * p2;\n}\n\nvec3 cubicBezierDerivative(vec3 p1, vec3 c1, vec3 c2, vec3 p2, float t) {\n  float t2 = 1.0 - t;\n  return -3.0 * p1 * t2 * t2 +\n    c1 * (3.0 * t2 * t2 - 6.0 * t2 * t) +\n    c2 * (6.0 * t2 * t - 3.0 * t * t) +\n    3.0 * p2 * t * t;\n}\n",vertexTransform:'\nfloat t = position.y;\nbezierT = t;\nvec3 bezierCenterPos = cubicBezier(pointA, controlA, controlB, pointB, t);\nvec3 bezierDir = normalize(cubicBezierDerivative(pointA, controlA, controlB, pointB, t));\n\n// Make "sideways" always perpendicular to the camera ray; this ensures that any twists\n// in the cylinder occur where you won\'t see them: \nvec3 viewDirection = normalMatrix * vec3(0.0, 0.0, 1.0);\nif (bezierDir == viewDirection) {\n  bezierDir = normalize(cubicBezierDerivative(pointA, controlA, controlB, pointB, t == 1.0 ? t - 0.0001 : t + 0.0001));\n}\nvec3 sideways = normalize(cross(bezierDir, viewDirection));\nvec3 upish = normalize(cross(sideways, bezierDir));\n\n// Build a matrix for transforming this disc in the cylinder:\nmat4 discTx;\ndiscTx[0].xyz = sideways * radius;\ndiscTx[1].xyz = bezierDir * radius;\ndiscTx[2].xyz = upish * radius;\ndiscTx[3].xyz = bezierCenterPos;\ndiscTx[3][3] = 1.0;\n\n// Apply transform, ignoring original y\nposition = (discTx * vec4(position.x, 0.0, position.z, 1.0)).xyz;\nnormal = normalize(mat3(discTx) * normal);\n',fragmentDefs:"\nuniform vec3 dashing;\nvarying float bezierT;\n",fragmentMainIntro:"\nif (dashing.x + dashing.y > 0.0) {\n  float dashFrac = mod(bezierT - dashing.z, dashing.x + dashing.y);\n  if (dashFrac > dashing.x) {\n    discard;\n  }\n}\n"})}(r),r.addEventListener("dispose",(function t(){r.removeEventListener("dispose",t),e.dispose()}))),e},n.material.set=function(e){this._baseMaterial=e},n.customDepthMaterial.get=function(){return this.material.getDepthMaterial()},n.customDistanceMaterial.get=function(){return this.material.getDistanceMaterial()},r.prototype.onBeforeRender=function(e){var t=this.material.uniforms,r=this.pointA,n=this.controlA,a=this.controlB,o=this.pointB,i=this.radius,s=this.dashArray,c=this.dashOffset;t.pointA.value.copy(r),t.controlA.value.copy(n),t.controlB.value.copy(a),t.pointB.value.copy(o),t.radius.value=i,t.dashing.value.set(s.x,s.y,c||0)},r.prototype.raycast=function(e,t){},Object.defineProperties(r.prototype,n),r}(t.Mesh);e.BezierMesh=y,e.ShaderFloatArray=f,e.createDerivedMaterial=c,e.expandShaderIncludes=n,e.getShaderUniformTypes=function(e){for(var t,r=/\buniform\s+(int|float|vec[234])\s+([A-Za-z_][\w]*)/g,n=Object.create(null);null!==(t=r.exec(e));)n[t[2]]=t[1];return n},e.getShadersForMaterial=function(e){var r=h[e.type];return r?t.ShaderLib[r]:e},e.voidMainRegExp=r,Object.defineProperty(e,"__esModule",{value:!0})}(t,r(72))},252:function(e,t,r){e.exports=function(){var e=function e(){function t(e){return a.appendChild(e.dom),e}function r(e){for(var t=0;t<a.children.length;t++)a.children[t].style.display=t===e?"block":"none";n=e}var n=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",(function(e){e.preventDefault(),r(++n%a.children.length)}),!1);var o=(performance||Date).now(),i=o,s=0,c=t(new e.Panel("FPS","#0ff","#002")),l=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:a,addPanel:t,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(l.update(e-o,200),e>i+1e3&&(c.update(1e3*s/(e-i),100),i=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:a,setMode:r}};return e.Panel=function(e,t,r){var n=1/0,a=0,o=Math.round,i=o(window.devicePixelRatio||1),s=80*i,c=48*i,l=3*i,u=2*i,h=3*i,f=15*i,d=74*i,v=30*i,p=document.createElement("canvas");p.width=s,p.height=c,p.style.cssText="width:80px;height:48px";var m=p.getContext("2d");return m.font="bold "+9*i+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=r,m.fillRect(0,0,s,c),m.fillStyle=t,m.fillText(e,l,u),m.fillRect(h,f,d,v),m.fillStyle=r,m.globalAlpha=.9,m.fillRect(h,f,d,v),{dom:p,update:function(c,y){n=Math.min(n,c),a=Math.max(a,c),m.fillStyle=r,m.globalAlpha=1,m.fillRect(0,0,s,f),m.fillStyle=t,m.fillText(o(c)+" "+e+" ("+o(n)+"-"+o(a)+")",l,u),m.drawImage(p,h+i,f,d-i,v,h,f,d-i,v),m.fillRect(h+d-i,f,i,v),m.fillStyle=r,m.globalAlpha=.9,m.fillRect(h+d-i,f,i,o((1-c/y)*v))}}},e}()},268:function(e,t,r){"use strict";r.d(t,"a",(function(){return le}));var n=r(5),a=r(8),o=r(9),i=(r(42),r(12),r(3),r(1)),s=r(0),c=r.n(s),l=r(76),u=r(119),h=r(127),f=r(101),d=r(4),v=r(72),p=function(e,t){void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),v.Object3D.call(this),this.visible=!1,this.domElement=t;var r=new m;this.add(r);var n=new y;this.add(n);var a=this;X("camera",e),X("object",void 0),X("enabled",!0),X("axis",null),X("mode","translate"),X("translationSnap",null),X("rotationSnap",null),X("scaleSnap",null),X("space","world"),X("size",1),X("dragging",!1),X("showX",!0),X("showY",!0),X("showZ",!0);var o={type:"change"},i={type:"mouseDown"},s={type:"mouseUp",mode:a.mode},c={type:"objectChange"},l=new v.Raycaster;function u(e,t,r){for(var n=t.intersectObject(e,!0),a=0;a<n.length;a++)if(n[a].object.visible||r)return n[a];return!1}var h=new v.Vector3,f=new v.Vector3,d=new v.Quaternion,p={X:new v.Vector3(1,0,0),Y:new v.Vector3(0,1,0),Z:new v.Vector3(0,0,1)},g=new v.Vector3,b=new v.Vector3,x=new v.Vector3,w=new v.Vector3,S=new v.Vector3,U=new v.Vector3,_=0,M=new v.Vector3,A=new v.Quaternion,E=new v.Vector3,T=new v.Vector3,C=new v.Quaternion,D=new v.Quaternion,k=new v.Vector3,O=new v.Vector3,P=new v.Quaternion,L=new v.Vector3,F=new v.Vector3,I=new v.Quaternion,B=new v.Quaternion,R=new v.Vector3,z=new v.Vector3,j=new v.Vector3,G=new v.Quaternion,V=new v.Vector3;function X(e,t){var i=t;Object.defineProperty(a,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,n[e]=t,r[e]=t,a.dispatchEvent({type:e+"-changed",value:t}),a.dispatchEvent(o))}}),a[e]=t,n[e]=t,r[e]=t}function N(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};var r=e.changedTouches?e.changedTouches[0]:e,n=t.getBoundingClientRect();return{x:(r.clientX-n.left)/n.width*2-1,y:-(r.clientY-n.top)/n.height*2+1,button:e.button}}function Y(e){a.enabled&&a.pointerHover(N(e))}function Z(e){a.enabled&&(document.addEventListener("mousemove",H,!1),a.pointerHover(N(e)),a.pointerDown(N(e)))}function H(e){a.enabled&&a.pointerMove(N(e))}function W(e){a.enabled&&(document.removeEventListener("mousemove",H,!1),a.pointerUp(N(e)))}X("worldPosition",F),X("worldPositionStart",O),X("worldQuaternion",I),X("worldQuaternionStart",P),X("cameraPosition",M),X("cameraQuaternion",A),X("pointStart",g),X("pointEnd",b),X("rotationAxis",w),X("rotationAngle",_),X("eye",z),t.addEventListener("mousedown",Z,!1),t.addEventListener("touchstart",Z,!1),t.addEventListener("mousemove",Y,!1),t.addEventListener("touchmove",Y,!1),t.addEventListener("touchmove",H,!1),document.addEventListener("mouseup",W,!1),t.addEventListener("touchend",W,!1),t.addEventListener("touchcancel",W,!1),t.addEventListener("touchleave",W,!1),this.dispose=function(){t.removeEventListener("mousedown",Z),t.removeEventListener("touchstart",Z),t.removeEventListener("mousemove",Y),document.removeEventListener("mousemove",H),t.removeEventListener("touchmove",Y),t.removeEventListener("touchmove",H),document.removeEventListener("mouseup",W),t.removeEventListener("touchend",W),t.removeEventListener("touchcancel",W),t.removeEventListener("touchleave",W),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(T,C,k),this.object.matrixWorld.decompose(F,I,R),D.copy(C).inverse(),B.copy(I).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(M,A,E),z.copy(M).sub(F).normalize(),v.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){l.setFromCamera(e,this.camera);var t=u(r.picker[this.mode],l);this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)&&(0===e.button||void 0===e.button)&&null!==this.axis){l.setFromCamera(e,this.camera);var t=u(n,l,!0);if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var a=this.rotationSnap;"X"===this.axis&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),"Y"===this.axis&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),"Z"===this.axis&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),j.copy(this.object.position),G.copy(this.object.quaternion),V.copy(this.object.scale),this.object.matrixWorld.decompose(O,P,L),g.copy(t.point).sub(O)}this.dragging=!0,i.mode=this.mode,this.dispatchEvent(i)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,a=this.object,i=this.space;if("scale"===r?i="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(i="world"),void 0!==a&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){l.setFromCamera(e,this.camera);var s=u(n,l,!0);if(s){if(b.copy(s.point).sub(O),"translate"===r)x.copy(b).sub(g),"local"===i&&"XYZ"!==t&&x.applyQuaternion(B),-1===t.indexOf("X")&&(x.x=0),-1===t.indexOf("Y")&&(x.y=0),-1===t.indexOf("Z")&&(x.z=0),"local"===i&&"XYZ"!==t?x.applyQuaternion(G).divide(k):x.applyQuaternion(D).divide(k),a.position.copy(x).add(j),this.translationSnap&&("local"===i&&(a.position.applyQuaternion(d.copy(G).inverse()),-1!==t.search("X")&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(G)),"world"===i&&(a.parent&&a.position.add(h.setFromMatrixPosition(a.parent.matrixWorld)),-1!==t.search("X")&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(h.setFromMatrixPosition(a.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var v=b.length()/g.length();b.dot(g)<0&&(v*=-1),f.set(v,v,v)}else h.copy(g),f.copy(b),h.applyQuaternion(B),f.applyQuaternion(B),f.divide(h),-1===t.search("X")&&(f.x=1),-1===t.search("Y")&&(f.y=1),-1===t.search("Z")&&(f.z=1);a.scale.copy(V).multiply(f),this.scaleSnap&&(-1!==t.search("X")&&(a.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){x.copy(b).sub(g);var m=20/F.distanceTo(h.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(w.copy(z),_=b.angleTo(g),S.copy(g).normalize(),U.copy(b).normalize(),_*=U.cross(S).dot(z)<0?1:-1):"XYZE"===t?(w.copy(x).cross(z).normalize(),_=x.dot(h.copy(w).cross(this.eye))*m):"X"!==t&&"Y"!==t&&"Z"!==t||(w.copy(p[t]),h.copy(p[t]),"local"===i&&h.applyQuaternion(I),_=x.dot(h.cross(z).normalize())*m),this.rotationSnap&&(_=Math.round(_/this.rotationSnap)*this.rotationSnap),this.rotationAngle=_,"local"===i&&"E"!==t&&"XYZE"!==t?(a.quaternion.copy(G),a.quaternion.multiply(d.setFromAxisAngle(w,_)).normalize()):(w.applyQuaternion(D),a.quaternion.copy(d.setFromAxisAngle(w,_)),a.quaternion.multiply(G).normalize())}this.dispatchEvent(o),this.dispatchEvent(c)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return a.mode},this.setMode=function(e){a.mode=e},this.setTranslationSnap=function(e){a.translationSnap=e},this.setRotationSnap=function(e){a.rotationSnap=e},this.setScaleSnap=function(e){a.scaleSnap=e},this.setSize=function(e){a.size=e},this.setSpace=function(e){a.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};p.prototype=Object.assign(Object.create(v.Object3D.prototype),{constructor:p,isTransformControls:!0});var m=function(){v.Object3D.call(this),this.type="TransformControlsGizmo";var e=new v.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:v.DoubleSide,fog:!1}),t=new v.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var n=e.clone();n.opacity=.33;var a=e.clone();a.color.set(16711680);var o=e.clone();o.color.set(65280);var i=e.clone();i.color.set(255);var s=e.clone();s.opacity=.25;var c=s.clone();c.color.set(16776960);var l=s.clone();l.color.set(65535);var u=s.clone();u.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var f=t.clone();f.color.set(65280);var d=t.clone();d.color.set(255);var p=t.clone();p.color.set(65535);var m=t.clone();m.color.set(16711935);var y=t.clone();y.color.set(16776960);var g=t.clone();g.color.set(7895160);var b=y.clone();b.opacity=.25;var x=new v.CylinderBufferGeometry(0,.05,.2,12,1,!1),w=new v.BoxBufferGeometry(.125,.125,.125),S=new v.BufferGeometry;S.setAttribute("position",new v.Float32BufferAttribute([0,0,0,1,0,0],3));var U=function(e,t){for(var r=new v.BufferGeometry,n=[],a=0;a<=64*t;++a)n.push(0,Math.cos(a/32*Math.PI)*e,Math.sin(a/32*Math.PI)*e);return r.setAttribute("position",new v.Float32BufferAttribute(n,3)),r},_={X:[[new v.Mesh(x,a),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new v.Mesh(x,a),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new v.Line(S,h)]],Y:[[new v.Mesh(x,o),[0,1,0],null,null,"fwd"],[new v.Mesh(x,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new v.Line(S,f),null,[0,0,Math.PI/2]]],Z:[[new v.Mesh(x,i),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new v.Mesh(x,i),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new v.Line(S,d),null,[0,-Math.PI/2,0]]],XYZ:[[new v.Mesh(new v.OctahedronBufferGeometry(.1,0),s.clone()),[0,0,0],[0,0,0]]],XY:[[new v.Mesh(new v.PlaneBufferGeometry(.295,.295),c.clone()),[.15,.15,0]],[new v.Line(S,y),[.18,.3,0],null,[.125,1,1]],[new v.Line(S,y),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new v.Mesh(new v.PlaneBufferGeometry(.295,.295),l.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new v.Line(S,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new v.Line(S,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new v.Mesh(new v.PlaneBufferGeometry(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new v.Line(S,m),[.18,0,.3],null,[.125,1,1]],[new v.Line(S,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},M={X:[[new v.Mesh(new v.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new v.Mesh(new v.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new v.Mesh(new v.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new v.Mesh(new v.OctahedronBufferGeometry(.2,0),r)]],XY:[[new v.Mesh(new v.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new v.Mesh(new v.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new v.Mesh(new v.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},A={START:[[new v.Mesh(new v.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],END:[[new v.Mesh(new v.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new v.Line(function(){var e=new v.BufferGeometry;return e.setAttribute("position",new v.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),n),null,null,null,"helper"]],X:[[new v.Line(S,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new v.Line(S,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new v.Line(S,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},E={X:[[new v.Line(U(1,.5),h)],[new v.Mesh(new v.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[1,3,1]]],Y:[[new v.Line(U(1,.5),f),null,[0,0,-Math.PI/2]],[new v.Mesh(new v.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new v.Line(U(1,.5),d),null,[0,Math.PI/2,0]],[new v.Mesh(new v.OctahedronBufferGeometry(.04,0),i),[.99,0,0],null,[1,3,1]]],E:[[new v.Line(U(1.25,1),b),null,[0,Math.PI/2,0]],[new v.Mesh(new v.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new v.Mesh(new v.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new v.Mesh(new v.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new v.Mesh(new v.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new v.Line(U(1,1),g),null,[0,Math.PI/2,0]]]},T={AXIS:[[new v.Line(S,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},C={X:[[new v.Mesh(new v.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new v.Mesh(new v.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new v.Mesh(new v.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new v.Mesh(new v.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new v.Mesh(new v.SphereBufferGeometry(.7,10,8),r)]]},D={X:[[new v.Mesh(w,a),[.8,0,0],[0,0,-Math.PI/2]],[new v.Line(S,h),null,null,[.8,1,1]]],Y:[[new v.Mesh(w,o),[0,.8,0]],[new v.Line(S,f),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new v.Mesh(w,i),[0,0,.8],[Math.PI/2,0,0]],[new v.Line(S,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new v.Mesh(w,c),[.85,.85,0],null,[2,2,.2]],[new v.Line(S,y),[.855,.98,0],null,[.125,1,1]],[new v.Line(S,y),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new v.Mesh(w,l),[0,.85,.85],null,[.2,2,2]],[new v.Line(S,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new v.Line(S,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new v.Mesh(w,u),[.85,0,.85],null,[2,.2,2]],[new v.Line(S,m),[.855,0,.98],null,[.125,1,1]],[new v.Line(S,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new v.Mesh(new v.BoxBufferGeometry(.125,.125,.125),s.clone()),[1.1,0,0]]],XYZY:[[new v.Mesh(new v.BoxBufferGeometry(.125,.125,.125),s.clone()),[0,1.1,0]]],XYZZ:[[new v.Mesh(new v.BoxBufferGeometry(.125,.125,.125),s.clone()),[0,0,1.1]]]},k={X:[[new v.Mesh(new v.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new v.Mesh(new v.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new v.Mesh(new v.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new v.Mesh(w,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new v.Mesh(w,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new v.Mesh(w,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new v.Mesh(new v.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new v.Mesh(new v.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new v.Mesh(new v.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},O={X:[[new v.Line(S,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new v.Line(S,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new v.Line(S,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P=function(e){var t=new v.Object3D;for(var r in e)for(var n=e[r].length;n--;){var a=e[r][n][0].clone(),o=e[r][n][1],i=e[r][n][2],s=e[r][n][3],c=e[r][n][4];a.name=r,a.tag=c,o&&a.position.set(o[0],o[1],o[2]),i&&a.rotation.set(i[0],i[1],i[2]),s&&a.scale.set(s[0],s[1],s[2]),a.updateMatrix();var l=a.geometry.clone();l.applyMatrix4(a.matrix),a.geometry=l,a.renderOrder=1/0,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1),t.add(a)}return t},L=new v.Vector3(0,0,0),F=new v.Euler,I=new v.Vector3(0,1,0),B=new v.Vector3(0,0,0),R=new v.Matrix4,z=new v.Quaternion,j=new v.Quaternion,G=new v.Quaternion,V=new v.Vector3(1,0,0),X=new v.Vector3(0,1,0),N=new v.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(_)),this.add(this.gizmo.rotate=P(E)),this.add(this.gizmo.scale=P(D)),this.add(this.picker.translate=P(M)),this.add(this.picker.rotate=P(C)),this.add(this.picker.scale=P(k)),this.add(this.helper.translate=P(A)),this.add(this.helper.rotate=P(T)),this.add(this.helper.scale=P(O)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:G;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var n=0;n<r.length;n++){var a,o=r[n];if(o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),a=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/7),"helper"!==o.tag){if(o.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==o.name&&"XYZX"!==o.name||Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Y"!==o.name&&"XYZY"!==o.name||Math.abs(I.copy(X).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Z"!==o.name&&"XYZZ"!==o.name||Math.abs(I.copy(N).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XY"===o.name&&Math.abs(I.copy(N).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"YZ"===o.name&&Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XZ"===o.name&&Math.abs(I.copy(X).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),-1!==o.name.search("X")&&(I.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===o.tag?o.visible=!1:o.scale.x*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Y")&&(I.copy(X).applyQuaternion(t).dot(this.eye)<0?"fwd"===o.tag?o.visible=!1:o.scale.y*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Z")&&(I.copy(N).applyQuaternion(t).dot(this.eye)<0?"fwd"===o.tag?o.visible=!1:o.scale.z*=-1:"bwd"===o.tag&&(o.visible=!1))}else"rotate"===this.mode&&(j.copy(t),I.copy(this.eye).applyQuaternion(z.copy(t).inverse()),-1!==o.name.search("E")&&o.quaternion.setFromRotationMatrix(R.lookAt(this.eye,B,X)),"X"===o.name&&(z.setFromAxisAngle(V,Math.atan2(-I.y,I.z)),z.multiplyQuaternions(j,z),o.quaternion.copy(z)),"Y"===o.name&&(z.setFromAxisAngle(X,Math.atan2(I.x,I.z)),z.multiplyQuaternions(j,z),o.quaternion.copy(z)),"Z"===o.name&&(z.setFromAxisAngle(N,Math.atan2(I.y,I.x)),z.multiplyQuaternions(j,z),o.quaternion.copy(z)));o.visible=o.visible&&(-1===o.name.indexOf("X")||this.showX),o.visible=o.visible&&(-1===o.name.indexOf("Y")||this.showY),o.visible=o.visible&&(-1===o.name.indexOf("Z")||this.showZ),o.visible=o.visible&&(-1===o.name.indexOf("E")||this.showX&&this.showY&&this.showZ),o.material._opacity=o.material._opacity||o.material.opacity,o.material._color=o.material._color||o.material.color.clone(),o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled?this.axis&&(o.name===this.axis||this.axis.split("").some((function(e){return o.name===e}))?(o.material.opacity=1,o.material.color.lerp(new v.Color(1,1,1),.5)):(o.material.opacity*=.25,o.material.color.lerp(new v.Color(1,1,1),.5))):(o.material.opacity*=.5,o.material.color.lerp(new v.Color(1,1,1),.5))}else o.visible=!1,"AXIS"===o.name?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,"X"===this.axis&&(z.setFromEuler(F.set(0,0,0)),o.quaternion.copy(t).multiply(z),Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),"Y"===this.axis&&(z.setFromEuler(F.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(z),Math.abs(I.copy(X).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),"Z"===this.axis&&(z.setFromEuler(F.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(z),Math.abs(I.copy(N).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),"XYZE"===this.axis&&(z.setFromEuler(F.set(0,Math.PI/2,0)),I.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(R.lookAt(B,I,X)),o.quaternion.multiply(z),o.visible=this.dragging),"E"===this.axis&&(o.visible=!1)):"START"===o.name?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):"END"===o.name?(o.position.copy(this.worldPosition),o.visible=this.dragging):"DELTA"===o.name?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),L.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),L.applyQuaternion(this.worldQuaternionStart.clone().inverse()),o.scale.copy(L),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=-1!==this.axis.search(o.name)))}v.Object3D.prototype.updateMatrixWorld.call(this)}};m.prototype=Object.assign(Object.create(v.Object3D.prototype),{constructor:m,isTransformControlsGizmo:!0});var y=function(){v.Mesh.call(this,new v.PlaneBufferGeometry(1e5,1e5,2,2),new v.MeshBasicMaterial({visible:!1,wireframe:!0,side:v.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new v.Vector3(1,0,0),t=new v.Vector3(0,1,0),r=new v.Vector3(0,0,1),n=new v.Vector3,a=new v.Vector3,o=new v.Vector3,i=new v.Matrix4,s=new v.Quaternion;this.updateMatrixWorld=function(){var c=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(c="local"),e.set(1,0,0).applyQuaternion("local"===c?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===c?this.worldQuaternion:s),r.set(0,0,1).applyQuaternion("local"===c?this.worldQuaternion:s),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),a.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),a.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(r),a.copy(r).cross(o);break;case"XY":a.copy(r);break;case"YZ":a.copy(e);break;case"XZ":o.copy(r),a.copy(t);break;case"XYZ":case"E":a.set(0,0,0)}break;case"rotate":default:a.set(0,0,0)}0===a.length()?this.quaternion.copy(this.cameraQuaternion):(i.lookAt(n.set(0,0,0),a,o),this.quaternion.setFromRotationMatrix(i)),v.Object3D.prototype.updateMatrixWorld.call(this)}};y.prototype=Object.assign(Object.create(v.Mesh.prototype),{constructor:y,isTransformControlsPlane:!0});r(247),r(248);var g=r(34);r(105),r(16);var b=r(106),x=r(23),w=(r(14),r(32)),S=r(17),U=0,_="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",M=(v.ShaderMaterial,"uniform sampler2D inputBuffer;uniform sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;\n#if PASS == 1\nuniform float kernel64[128];\n#else\nuniform float kernel16[32];\n#endif\nvarying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\n#if PASS == 1\nvec4 acc=vec4(0.0);for(int i=0;i<128;i+=2){vec2 uv=step*vec2(kernel64[i],kernel64[i+1])+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;\n#else\nvec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<32;i+=2){vec2 uv=step*vec2(kernel16[i],kernel16[i+1])+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;\n#endif\n}}"),A=(v.ShaderMaterial,v.ShaderMaterial,"uniform sampler2D inputBuffer;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;void main(){const vec2 threshold=vec2(EDGE_THRESHOLD);vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);}"),E="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}",T=(v.ShaderMaterial,"#include <common>\n#include <dithering_pars_fragment>\nuniform sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <dithering_fragment>\n}"),C="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;/*Packing multiple texture coordinates into one varying and using a swizzle toextract them in the fragment shader still causes a dependent texture read.*/varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",D=(v.ShaderMaterial,[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])]),k={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},O=(v.ShaderMaterial,"#include <packing>\n#include <clipping_planes_pars_fragment>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float cameraNear;uniform float cameraFar;varying float vViewZ;varying vec4 vProjTexCoord;void main(){\n#include <clipping_planes_fragment>\nvec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);\n#else\nfloat viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);\n#endif\nfloat depthTest=(-vViewZ>-viewZ)? 1.0 : 0.0;gl_FragColor.rg=vec2(0.0,depthTest);}"),P="#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying float vViewZ;varying vec4 vProjTexCoord;void main(){\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\nvViewZ=mvPosition.z;vProjTexCoord=gl_Position;\n#include <clipping_planes_vertex>\n}",L=(v.ShaderMaterial,v.ShaderMaterial,v.ShaderMaterial,v.ShaderMaterial,{DEPTH:0,LUMA:1,COLOR:2}),F=(v.ShaderMaterial,{FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"}),I=(v.ShaderMaterial,"#include <common>\nuniform sampler2D inputBuffer;\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=linearToRelativeLuminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}"),B=(v.ShaderMaterial,"uniform sampler2D maskTexture;uniform sampler2D inputBuffer;\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nif(mask>0.0){discard;}\n#else\nif(mask==0.0){discard;}\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=(1.0-mask);\n#endif\n#if MASK_FUNCTION == 1\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#else\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#endif\n#endif\n}"),R=(v.ShaderMaterial,{DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2}),z="uniform sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)? vec2(d,0.0): vec2(0.0,d);}",j="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",G=(v.ShaderMaterial,"#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\nuniform sampler2D inputBuffer;uniform sampler2D areaTexture;uniform sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;/***Moves values to a target vector based on a given conditional vector.*/void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}/***Allows to decode two binary values from a bilinear-filtered access.**Bilinear access for fetching 'e' have a 0.25 offset,and we are interested*in the R and G edges:**+---G---+-------+*|x o R   x|*+-------+-------+**Then,if one of these edge is enabled:*Red:(0.75*X+0.25*1)=>0.25 or 1.0*Green:(0.75*1+0.25*X)=>0.75 or 1.0**This function will unpack the values(mad+mul+round):*wolframalpha.com: round(x*abs(5*x-5*0.75))plot 0 to 1*/vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}/***Diagonal pattern searches.*/vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}/***Calculates the area corresponding to a certain diagonal distance and crossing*edges 'e'.*/vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}/***Searches for diagonal patterns and returns the corresponding weights.*/vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}/***Determines how much length should be added in the last step of the searches.**Takes the bilinearly interpolated edge(see @PSEUDO_GATHER4),and adds 0,1*or 2 depending on which edges and crossing edges are active.*/float searchLength(const in vec2 e,const in float offset){/*The texture is flipped vertically,with left and right cases taking halfof the space horizontally.*/vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}/***Horizontal search for the second pass.*/float searchXLeft(in vec2 texCoord,const in float end){/*@PSEUDO_GATHER4This texCoord has been offset by(-0.25,-0.125)in the vertex shader tosample between edges,thus fetching four edges in a row.Sampling with different offsets in each direction allows to disambiguatewhich edges are active from the four fetched ones.*/vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}/***Vertical search for the second pass.*/float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}/***Determines the areas at each side of the current edge.*/vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}/***Corner detection.*/void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\n/*Diagonals have both north and west edges,so searching for them in one ofthe boundaries is enough.*/weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;/*Now fetch the left crossing edges,two at a time using bilinearfiltering. Sampling at-0.25(see @CROSSING_OFFSET)enables to discern whatvalue each edge has.*/float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;/*Translate distances to pixel units for better interleave arithmetic andmemory accesses.*/d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}"),V="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}";v.ShaderMaterial,v.ShaderMaterial,new v.Camera;new v.Color;var X=0,N=2,Y=10,Z=13,H=14,W=16;new Map([[X,null],[1,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[N,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[3,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[4,"float blend(const in float x,const in float y){return(y==0.0)? y : max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[5,"float blend(const in float x,const in float y){return(y==1.0)? y : min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[6,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[7,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[8,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[9,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[Y,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[11,"float blend(const in float x,const in float y){return(y>0.0)? min(x/y,1.0): 1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[12,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[Z,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[H,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[15,"float blend(const in float x,const in float y){return(y==1.0)? y : min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[W,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[17,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[18,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]);Set;function q(e,t,r){var n,a=new Map([[v.LuminanceFormat,1],[v.RedFormat,1],[v.RGFormat,2],[v.RGBFormat,3],[v.RGBAFormat,4]]);if(a.has(t)||console.error("Invalid noise texture format"),r===v.UnsignedByteType)for(var o=0,i=(n=new Uint8Array(e*a.get(t))).length;o<i;++o)n[o]=255*Math.random();else for(var s=0,c=(n=new Float32Array(e*a.get(t))).length;s<c;++s)n[s]=Math.random();return n}v.DataTexture;var Q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(n.a)(this,e),this.width=t,this.height=r,this.data=a}return Object(S.a)(e,[{key:"toCanvas",value:function(){return"undefined"===typeof document?null:function(e,t,r){var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),a=n.getContext("2d"),o=a.createImageData(e,t);return o.data.set(r),n.width=e,n.height=t,a.putImageData(o,0,0),n}(this.width,this.height,this.data)}}],[{key:"from",value:function(t){return new e(t.width,t.height,t.data)}}]),e}(),K='!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}var n=function(){function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e(this,t),this.width=a,this.height=n,this.data=s}return a(t,[{key:"toCanvas",value:function(){return"undefined"==typeof document?null:(e=this.width,t=this.height,a=this.data,n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),s=n.getContext("2d"),(r=s.createImageData(e,t)).data.set(a),n.width=e,n.height=t,s.putImageData(r,0,0),n);var e,t,a,n,s,r}}],[{key:"from",value:function(e){return new t(e.width,e.height,e.data)}}]),t}(),s=function(){function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=a,this.y=n}return a(t,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"equals",value:function(e){return this===e||this.x===e.x&&this.y===e.y}}]),t}(),r=function t(){e(this,t),this.min=new s,this.max=new s},i=new r,y=new r,c=new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),u=[new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125])],h=[new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4])],o=[new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3])];function w(e,t,a){return e+(t-e)*a}function x(e,t){var a,n=t.min,s=t.max,r=.5*Math.sqrt(2*n.x),i=.5*Math.sqrt(2*n.y),y=.5*Math.sqrt(2*s.x),c=.5*Math.sqrt(2*s.y),u=(a=e/32,Math.min(Math.max(a,0),1));return n.set(w(r,n.x,u),w(i,n.y,u)),s.set(w(y,s.x,u),w(c,s.y,u)),t}function f(e,t,a,n){var s,r,i,y,c=t.x-e.x,u=t.y-e.y,h=a,o=a+1,w=e.y+u*(h-e.x)/c,x=e.y+u*(o-e.x)/c;return h>=e.x&&h<t.x||o>e.x&&o<=t.x?Math.sign(w)===Math.sign(x)||Math.abs(w)<1e-4||Math.abs(x)<1e-4?(s=(w+x)/2)<0?n.set(Math.abs(s),0):n.set(0,Math.abs(s)):(r=(y=-e.y*c/u+e.x)>e.x?w*(y-Math.trunc(y))/2:0,i=y<t.x?x*(1-(y-Math.trunc(y)))/2:0,(s=Math.abs(r)>Math.abs(i)?r:-i)<0?n.set(Math.abs(r),Math.abs(i)):n.set(Math.abs(i),Math.abs(r))):n.set(0,0),n}function l(e,t,a,n,s){var r=i.min,c=i.max,u=y.min,h=y.max,o=y,w=.5+n,l=.5+n-1,b=t+a+1;switch(e){case 0:s.set(0,0);break;case 1:t<=a?f(r.set(0,l),c.set(b/2,0),t,s):s.set(0,0);break;case 2:t>=a?f(r.set(b/2,0),c.set(b,l),t,s):s.set(0,0);break;case 3:f(r.set(0,l),c.set(b/2,0),t,u),f(r.set(b/2,0),c.set(b,l),t,h),x(b,o),s.set(u.x+h.x,u.y+h.y);break;case 4:t<=a?f(r.set(0,w),c.set(b/2,0),t,s):s.set(0,0);break;case 5:s.set(0,0);break;case 6:Math.abs(n)>0?(f(r.set(0,w),c.set(b,l),t,u),f(r.set(0,w),c.set(b/2,0),t,h),f(r.set(b/2,0),c.set(b,l),t,s),h.set(h.x+s.x,h.y+s.y),s.set((u.x+h.x)/2,(u.y+h.y)/2)):f(r.set(0,w),c.set(b,l),t,s);break;case 7:f(r.set(0,w),c.set(b,l),t,s);break;case 8:t>=a?f(r.set(b/2,0),c.set(b,w),t,s):s.set(0,0);break;case 9:Math.abs(n)>0?(f(r.set(0,l),c.set(b,w),t,u),f(r.set(0,l),c.set(b/2,0),t,h),f(r.set(b/2,0),c.set(b,w),t,s),h.set(h.x+s.x,h.y+s.y),s.set((u.x+h.x)/2,(u.y+h.y)/2)):f(r.set(0,l),c.set(b,w),t,s);break;case 10:s.set(0,0);break;case 11:f(r.set(0,l),c.set(b,w),t,s);break;case 12:f(r.set(0,w),c.set(b/2,0),t,u),f(r.set(b/2,0),c.set(b,w),t,h),x(b,o),s.set(u.x+h.x,u.y+h.y);break;case 13:f(r.set(0,l),c.set(b,w),t,s);break;case 14:f(r.set(0,w),c.set(b,l),t,s);break;case 15:s.set(0,0)}return s}function b(e,t,a,n){var s=e.equals(t);if(!s){var r=(e.x+t.x)/2,i=(e.y+t.y)/2;s=(t.y-e.y)*(a-r)+(e.x-t.x)*(n-i)>0}return s}function A(e,t,a,n){var s,r,i;for(s=0,i=0;i<30;++i)for(r=0;r<30;++r)b(e,t,a+r/29,n+i/29)&&++s;return s/900}function v(e,t,a,n,s,r){var i=o[e],y=i[0],c=i[1];return y>0&&(t.x+=s[0],t.y+=s[1]),c>0&&(a.x+=s[0],a.y+=s[1]),r.set(1-A(t,a,1+n,0+n),A(t,a,1+n,1+n))}function k(e,t,a,n,s){var r=i.min,c=i.max,u=y.min,h=y.max,o=t+a+1;switch(e){case 0:v(e,r.set(1,1),c.set(1+o,1+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 1:v(e,r.set(1,0),c.set(0+o,0+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 2:v(e,r.set(0,0),c.set(1+o,0+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 3:v(e,r.set(1,0),c.set(1+o,0+o),t,n,s);break;case 4:v(e,r.set(1,1),c.set(0+o,0+o),t,n,u),v(e,r.set(1,1),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 5:v(e,r.set(1,1),c.set(0+o,0+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 6:v(e,r.set(1,1),c.set(1+o,0+o),t,n,s);break;case 7:v(e,r.set(1,1),c.set(1+o,0+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 8:v(e,r.set(0,0),c.set(1+o,1+o),t,n,u),v(e,r.set(1,0),c.set(1+o,1+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 9:v(e,r.set(1,0),c.set(1+o,1+o),t,n,s);break;case 10:v(e,r.set(0,0),c.set(1+o,1+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 11:v(e,r.set(1,0),c.set(1+o,1+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 12:v(e,r.set(1,1),c.set(1+o,1+o),t,n,s);break;case 13:v(e,r.set(1,1),c.set(1+o,1+o),t,n,u),v(e,r.set(1,0),c.set(1+o,1+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 14:v(e,r.set(1,1),c.set(1+o,1+o),t,n,u),v(e,r.set(1,1),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2);break;case 15:v(e,r.set(1,1),c.set(1+o,1+o),t,n,u),v(e,r.set(1,0),c.set(1+o,0+o),t,n,h),s.set((u.x+h.x)/2,(u.y+h.y)/2)}return s}function U(e,t,a){var n,r,i,y,c,u,h,o,w=new s;for(n=0,r=e.length;n<r;++n)for(h=(u=e[n]).data,o=u.width,y=0;y<o;++y)for(i=0;i<o;++i)a?l(n,i,y,t,w):k(n,i,y,t,w),h[c=2*(y*o+i)]=255*w.x,h[c+1]=255*w.y}function d(e,t,a,n,r,i){var y,c,u,h,o,w,x,f,l,b,A=new s,v=i.data,k=i.width;for(y=0,c=t.length;y<c;++y)for(x=a[y],l=(f=t[y]).data,b=f.width,h=0;h<n;++h)for(u=0;u<n;++u)A.set(x[0]*n+e.x+u,x[1]*n+e.y+h),w=r?2*(h*h*b+u*u):2*(h*b+u),v[o=4*(A.y*k+A.x)]=l[w],v[o+1]=l[w+1],v[o+2]=0,v[o+3]=255}var g=function(){function t(){e(this,t)}return a(t,null,[{key:"generate",value:function(){var e,t,a=5*c.length*16,r=new Uint8ClampedArray(160*a*4),i=new n(160,a,r),y=Math.pow(15,2)+1,w=[],x=[],f=new s;for(e=0;e<16;++e)w.push(new n(y,y,new Uint8ClampedArray(y*y*2),2)),x.push(new n(20,20,new Uint8ClampedArray(800),2));for(e=0,t=c.length;e<t;++e)U(w,c[e],!0),f.set(0,80*e),d(f,w,h,16,!0,i);for(e=0,t=u.length;e<t;++e)U(x,u[e],!1),f.set(80,80*e),d(f,x,o,20,!1,i);return i}}]),t}(),m=new Map([[p([0,0,0,0]),[0,0,0,0]],[p([0,0,0,1]),[0,0,0,1]],[p([0,0,1,0]),[0,0,1,0]],[p([0,0,1,1]),[0,0,1,1]],[p([0,1,0,0]),[0,1,0,0]],[p([0,1,0,1]),[0,1,0,1]],[p([0,1,1,0]),[0,1,1,0]],[p([0,1,1,1]),[0,1,1,1]],[p([1,0,0,0]),[1,0,0,0]],[p([1,0,0,1]),[1,0,0,1]],[p([1,0,1,0]),[1,0,1,0]],[p([1,0,1,1]),[1,0,1,1]],[p([1,1,0,0]),[1,1,0,0]],[p([1,1,0,1]),[1,1,0,1]],[p([1,1,1,0]),[1,1,1,0]],[p([1,1,1,1]),[1,1,1,1]]]);function M(e,t,a){return e+(t-e)*a}function p(e){var t=M(e[0],e[1],.75),a=M(e[2],e[3],.75);return M(t,a,.875)}function C(e,t){var a=0;return 1===t[3]&&1!==e[1]&&1!==e[3]&&(a+=1),1===a&&1===t[2]&&1!==e[0]&&1!==e[2]&&(a+=1),a}var q=function(){function t(){e(this,t)}return a(t,null,[{key:"generate",value:function(){var e,t,a,s,r,i,y,c,u,h,o=new Uint8ClampedArray(2178),w=new Uint8ClampedArray(4096);for(t=0;t<33;++t)for(e=0;e<66;++e)a=.03125*e,s=.03125*t,m.has(a)&&m.has(s)&&(i=m.get(a),y=m.get(s),o[r=66*t+e]=127*(c=i,h=void 0,h=0,1===(u=y)[3]&&(h+=1),1===h&&1===u[2]&&1!==c[1]&&1!==c[3]&&(h+=1),h),o[r+33]=127*C(i,y));for(r=0,t=17;t<33;++t)for(e=0;e<64;++e,r+=4)w[r]=o[66*t+e],w[r+3]=255;return new n(64,16,w)}}]),t}();self.addEventListener("message",(function(e){var t=g.generate(),a=q.generate();postMessage({areaImageData:t,searchImageData:a},[t.data.buffer,a.data.buffer]),close()}))}();\n';function $(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=URL.createObjectURL(new Blob([K],{type:"text/javascript"})),r=new Worker(t);return new Promise((function(n,a){r.addEventListener("error",(function(e){return a(e.error)})),r.addEventListener("message",(function(r){var a=Q.from(r.data.searchImageData),o=Q.from(r.data.areaImageData),i=[a.toCanvas().toDataURL(),o.toCanvas().toDataURL()];e||void 0===window.localStorage||(localStorage.setItem("smaa-search",i[0]),localStorage.setItem("smaa-area",i[1])),URL.revokeObjectURL(t),n(i)})),r.postMessage(null)}))}v.Loader;var J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(n.a)(this,e),this.x=t,this.y=r}return Object(S.a)(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"equals",value:function(e){return this===e||this.x===e.x&&this.y===e.y}}]),e}(),ee=function e(){Object(n.a)(this,e),this.min=new J,this.max=new J};new ee,new ee,new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]);new Map([[re([0,0,0,0]),[0,0,0,0]],[re([0,0,0,1]),[0,0,0,1]],[re([0,0,1,0]),[0,0,1,0]],[re([0,0,1,1]),[0,0,1,1]],[re([0,1,0,0]),[0,1,0,0]],[re([0,1,0,1]),[0,1,0,1]],[re([0,1,1,0]),[0,1,1,0]],[re([0,1,1,1]),[0,1,1,1]],[re([1,0,0,0]),[1,0,0,0]],[re([1,0,0,1]),[1,0,0,1]],[re([1,0,1,0]),[1,0,1,0]],[re([1,0,1,1]),[1,0,1,1]],[re([1,1,0,0]),[1,1,0,0]],[re([1,1,0,1]),[1,1,0,1]],[re([1,1,1,0]),[1,1,1,0]],[re([1,1,1,1]),[1,1,1,1]]]);function te(e,t,r){return e+(t-e)*r}function re(e){var t=te(e[0],e[1],.75),r=te(e[2],e[3],.75);return te(t,r,.875)}new v.Vector3,new v.Matrix4,Math.PI,new v.Vector3,new v.Vector3;var ne=r(249),ae=(r(41),r(252),function e(){var t=e.SkyShader,r=new v.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:v.UniformsUtils.clone(t.uniforms),side:v.BackSide,depthWrite:!1});v.Mesh.call(this,new v.BoxBufferGeometry(1,1,1),r)});ae.prototype=Object.create(v.Mesh.prototype),ae.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new v.Vector3},up:{value:new v.Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var oe=r(93),ie=r(85),se=r(123),ce=function(e){v.Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};ce.prototype=Object.assign(Object.create(v.Loader.prototype),{constructor:ce,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,r,n){var a=this,o=new v.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&o.setWithCredentials(!0),o.load(e,(function(e){var r={attributeIDs:a.defaultAttributeIDs,attributeTypes:a.defaultAttributeTypes,useUniqueIDs:!1};a.decodeGeometry(e,r).then(t).catch(n)}),r,n)},decodeDracoFile:function(e,t,r,n){var a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,a).then(t)},decodeGeometry:function(e,t){var r=this;for(var n in t.attributeTypes){var a=t.attributeTypes[n];void 0!==a.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=a.name)}var o,i=JSON.stringify(t);if(ce.taskCache.has(e)){var s=ce.taskCache.get(e);if(s.key===i)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var c=this.workerNextTaskID++,l=e.byteLength,u=this._getWorker(c,l).then((function(r){return o=r,new Promise((function(r,n){o._callbacks[c]={resolve:r,reject:n},o.postMessage({type:"decode",id:c,taskConfig:t,buffer:e},[e])}))})).then((function(e){return r._createGeometry(e.geometry)}));return u.catch((function(){return!0})).then((function(){o&&c&&r._releaseTask(o,c)})),ce.taskCache.set(e,{key:i,promise:u}),u},_createGeometry:function(e){var t=new v.BufferGeometry;e.index&&t.setIndex(new v.BufferAttribute(e.index.array,1));for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r],a=n.name,o=n.array,i=n.itemSize;t.setAttribute(a,new v.BufferAttribute(o,i))}return t},_loadLibrary:function(e,t){var r=new v.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),new Promise((function(t,n){r.load(e,t,void 0,n)}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,r=[];return t?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then((function(r){var n=r[0];t||(e.decoderConfig.wasmBinary=r[1]);var a=ce.DRACOWorker.toString(),o=["/* draco decoder */",n,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([o]))})),this.decoderPending},_getWorker:function(e,t){var r=this;return this._initDecoder().then((function(){var n;r.workerPool.length<r.workerLimit?((n=new Worker(r.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:r.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},r.workerPool.push(n)):r.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(n=r.workerPool[r.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),ce.DRACOWorker=function(){var e,t;function r(e,t,r,n,a,o){var i,s,c=o.num_components(),l=r.num_points()*c;switch(a){case Float32Array:i=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,o,i),s=new Float32Array(l);break;case Int8Array:i=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,o,i),s=new Int8Array(l);break;case Int16Array:i=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,o,i),s=new Int16Array(l);break;case Int32Array:i=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,o,i),s=new Int32Array(l);break;case Uint8Array:i=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,o,i),s=new Uint8Array(l);break;case Uint16Array:i=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,o,i),s=new Uint16Array(l);break;case Uint32Array:i=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,o,i),s=new Uint32Array(l);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var u=0;u<l;u++)s[u]=i.GetValue(u);return e.destroy(i),{name:n,array:s,itemSize:c}}onmessage=function(n){var a=n.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var o=a.buffer,i=a.taskConfig;t.then((function(e){var t=e.draco,n=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(o),o.byteLength);try{var c=function(e,t,n,a){var o,i,s=a.attributeIDs,c=a.attributeTypes,l=t.GetEncodedGeometryType(n);if(l===e.TRIANGULAR_MESH)o=new e.Mesh,i=t.DecodeBufferToMesh(n,o);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,i=t.DecodeBufferToPointCloud(n,o)}if(!i.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+i.error_msg());var u={index:null,attributes:[]};for(var h in s){var f,d,v=self[c[h]];if(a.useUniqueIDs)d=s[h],f=t.GetAttributeByUniqueId(o,d);else{if(-1===(d=t.GetAttributeId(o,e[s[h]])))continue;f=t.GetAttribute(o,d)}u.attributes.push(r(e,t,o,h,v,f))}if(l===e.TRIANGULAR_MESH){for(var p=o.num_faces(),m=new Uint32Array(3*p),y=new e.DracoInt32Array,g=0;g<p;++g){t.GetFaceFromMesh(o,g,y);for(var b=0;b<3;++b)m[3*g+b]=y.GetValue(b)}u.index={array:m,itemSize:1},e.destroy(y)}return e.destroy(o),u}(t,n,s,i),l=c.attributes.map((function(e){return e.array.buffer}));c.index&&l.push(c.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:c},l)}catch(u){console.error(u),self.postMessage({type:"error",id:a.id,error:u.message})}finally{t.destroy(s),t.destroy(n)}}))}}},ce.taskCache=new WeakMap,ce.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},ce.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},ce.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},ce.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")},Object(l.d)({OrbitControlsImpl:u.b});Object(l.d)({MapControlsImpl:u.a});Object(l.d)({TrackballControlsImpl:f.a});var le=Object(s.forwardRef)((function(e,t){var r=Object(s.useRef)(),n=Object(l.h)(),a=n.camera,o=n.gl,u=n.invalidate;return Object(l.f)((function(){var e;return null==(e=r.current)?void 0:e.update()})),Object(s.useEffect)((function(){var e;return null==(e=r.current)||e.addEventListener("change",u),function(){var e;return null==(e=r.current)?void 0:e.removeEventListener("change",u)}}),[r.current]),c.a.createElement("trackballControlsImpl",Object(i.default)({ref:Object(h.a)([r,t]),args:[a,o.domElement]},e))}));Object(l.d)({TransformControlsImpl:p});Object(l.d)({TextMeshImpl:ne.TextMesh});new v.Vector3,new v.Vector3,new v.Vector3;function ue(e){var t=this;v.MeshStandardMaterial.call(this),this.setValues(e),this._time={value:0},this._factor={value:1},this.onBeforeCompile=function(e){e.uniforms.time=t._time,e.uniforms.factor=t._factor,e.vertexShader="uniform float time; uniform float factor;\n"+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","float theta = sin( time + position.y ) / 2.0 * factor;\n        float c = cos( theta );\n        float s = sin( theta );\n        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );\n        vec3 transformed = vec3( position ) * m;\n        vNormal = vNormal * m;")},Object.defineProperty(this,"time",{get:function(){return t._time},set:function(e){return t._time.value=e}}),Object.defineProperty(this,"factor",{get:function(){return t._factor},set:function(e){return t._factor.value=e}})}ue.prototype=Object.create(v.MeshStandardMaterial.prototype),ue.prototype.constructor=v.MeshStandardMaterial,ue.prototype.isMeshStandardMaterial=!0,Object(l.d)({WobbleMaterialImpl:ue});Object(l.d)({SkyImpl:ae});Object(l.d)({Line2:se.a,LineGeometry:oe.a,LineMaterial:ie.a});var he=function(e){Object(a.a)(r,e);var t=Object(o.a)(r);function r(){return Object(n.a)(this,r),t.call(this,{uniforms:{time:{value:0},fade:{value:1}},vertexShader:"uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(mvPosition.x + 2.0 * time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n      }"})}return r}(v.ShaderMaterial);Object(l.d)({StarfieldMaterial:he});new v.Matrix4,new v.Ray,new v.Sphere,new v.Vector3;function fe(e){var t=e+"BufferGeometry";return Object(s.forwardRef)((function(e,r){var n=e.args,a=e.children,o=Object(d.default)(e,["args","children"]);return c.a.createElement("mesh",Object(i.default)({ref:r},o),c.a.createElement(t,{attach:"geometry",args:n}),a)}))}fe("box"),fe("circle"),fe("cone"),fe("cylinder"),fe("sphere"),fe("plane"),fe("tube"),fe("torus"),fe("torusKnot"),fe("tetrahedron"),fe("ring"),fe("polyhedron"),fe("icosahedron"),fe("octahedron"),fe("dodecahedron"),fe("extrude"),fe("lathe"),fe("parametric")},85:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(72);n.UniformsLib.line={linewidth:{value:1},resolution:{value:new n.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},opacity:{value:1}},n.ShaderLib.line={uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,n.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var a=function(e){n.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:n.UniformsUtils.clone(n.ShaderLib.line.uniforms),vertexShader:n.ShaderLib.line.vertexShader,fragmentShader:n.ShaderLib.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};a.prototype=Object.create(n.ShaderMaterial.prototype),a.prototype.constructor=a,a.prototype.isLineMaterial=!0},93:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(94),a=function(){n.a.call(this),this.type="LineGeometry"};a.prototype=Object.assign(Object.create(n.a.prototype),{constructor:a,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,r=new Float32Array(2*t),a=0;a<t;a+=3)r[2*a]=e[a],r[2*a+1]=e[a+1],r[2*a+2]=e[a+2],r[2*a+3]=e[a+3],r[2*a+4]=e[a+4],r[2*a+5]=e[a+5];return n.a.prototype.setPositions.call(this,r),this},setColors:function(e){for(var t=e.length-3,r=new Float32Array(2*t),a=0;a<t;a+=3)r[2*a]=e[a],r[2*a+1]=e[a+1],r[2*a+2]=e[a+2],r[2*a+3]=e[a+3],r[2*a+4]=e[a+4],r[2*a+5]=e[a+5];return n.a.prototype.setColors.call(this,r),this},fromLine:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this},copy:function(){return this}})},94:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(72),a=function(){n.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new n.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new n.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};a.prototype=Object.assign(Object.create(n.InstancedBufferGeometry.prototype),{constructor:a,isLineSegmentsGeometry:!0,applyMatrix4:function(e){var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var r=new n.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new n.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new n.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var r=new n.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new n.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new n.InterleavedBufferAttribute(r,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new n.WireframeGeometry(e.geometry)),this},fromLineSegments:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this},computeBoundingBox:function(){var e=new n.Box3;return function(){null===this.boundingBox&&(this.boundingBox=new n.Box3);var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;void 0!==t&&void 0!==r&&(this.boundingBox.setFromBufferAttribute(t),e.setFromBufferAttribute(r),this.boundingBox.union(e))}}(),computeBoundingSphere:function(){var e=new n.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new n.Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;if(void 0!==t&&void 0!==r){var a=this.boundingSphere.center;this.boundingBox.getCenter(a);for(var o=0,i=0,s=t.count;i<s;i++)e.fromBufferAttribute(t,i),o=Math.max(o,a.distanceToSquared(e)),e.fromBufferAttribute(r,i),o=Math.max(o,a.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}})}}]);
//# sourceMappingURL=12.67729b75.chunk.js.map